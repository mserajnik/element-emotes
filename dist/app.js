function xe(u,e){for(var t=0;t<e.length;t++){const D=e[t];if(typeof D!="string"&&!Array.isArray(D)){for(const n in D)if(n!=="default"&&!(n in u)){const r=Object.getOwnPropertyDescriptor(D,n);r&&Object.defineProperty(u,n,r.get?r:{enumerable:!0,get:()=>D[n]})}}}return Object.freeze(Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}))}/*!
 * element-emotes
 * Copyright (C) 2022-present  Michael Serajnik  https://github.com/mserajnik
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */const Qe=(u,e)=>`${u}?accessKey=${e}`,Ve={fetchEmotes:async()=>{let u=await fetch(Qe(p.get("emotesUrl"),p.get("accessKey")));if(!u.ok){const e=new Error(`HTTP status code: ${u.status}`);throw e.response=u,e.status=u.status,e}return u=await u.json(),u.emotes}};/*!
 * element-emotes
 * Copyright (C) 2022-present  Michael Serajnik  https://github.com/mserajnik
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */let me=!1;const U={emotesUrl:null,accessKey:null,defaultEmoteSize:"2em",largeEmoteSize:"4em",useFrozenEmotes:!1,emoteSuggestionAmount:10,useEmoteFuzzyMatching:!0,emoteFuzzyMatchingLocation:0,emoteFuzzyMatchingDistance:100,emoteFuzzyMatchingThreshold:.6,emoteSuggestionBlacklistedStrings:"",usernameColors:["","","","","","","",""],emotes:[]},p={initialize:()=>new Promise((u,e)=>{chrome.storage.sync.get(null,async t=>{if(chrome.runtime.lastError)return e(new Error("Error while intializing the store."));for(const D in t)Object.hasOwn(U,D)&&(U[D]=t[D]);me=!0;try{U.emotes=await Ve.fetchEmotes()}catch{return e(new Error("Error while trying to fetch the emote list; is the emote server URL and/or access key set correctly?"))}u()})}),get:u=>{if(!me)throw new Error("Store has not been initialized; call `store.initialize()` first.");return U[u]}};var _=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function le(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var Xe=/\uD83E\uDDD1(?:\uD83C\uDFFF\u200D\u2764\uFE0F\u200D\uD83D\uDC8B\u200D\uD83E\uDDD1(?:\uD83C[\uDFFB-\uDFFE])|\uD83C\uDFFE\u200D\u2764\uFE0F\u200D\uD83D\uDC8B\u200D\uD83E\uDDD1(?:\uD83C[\uDFFB-\uDFFD\uDFFF])|\uD83C\uDFFD\u200D\u2764\uFE0F\u200D\uD83D\uDC8B\u200D\uD83E\uDDD1(?:\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])|\uD83C\uDFFC\u200D\u2764\uFE0F\u200D\uD83D\uDC8B\u200D\uD83E\uDDD1(?:\uD83C[\uDFFB\uDFFD-\uDFFF])|\uD83C\uDFFB\u200D\u2764\uFE0F\u200D\uD83D\uDC8B\u200D\uD83E\uDDD1(?:\uD83C[\uDFFC-\uDFFF]))|\uD83D\uDC68(?:\uD83C[\uDFFB-\uDFFF])\u200D\u2764\uFE0F\u200D\uD83D\uDC8B\u200D\uD83D\uDC68(?:\uD83C[\uDFFB-\uDFFF])|\uD83D\uDC69(?:\uD83C[\uDFFB-\uDFFF])\u200D\u2764\uFE0F\u200D\uD83D\uDC8B\u200D(?:\uD83D[\uDC68\uDC69])(?:\uD83C[\uDFFB-\uDFFF])|\uD83E\uDDD1(?:\uD83C\uDFFF\u200D\u2764\u200D\uD83D\uDC8B\u200D\uD83E\uDDD1(?:\uD83C[\uDFFB-\uDFFE])|\uD83C\uDFFE\u200D\u2764\u200D\uD83D\uDC8B\u200D\uD83E\uDDD1(?:\uD83C[\uDFFB-\uDFFD\uDFFF])|\uD83C\uDFFD\u200D\u2764\u200D\uD83D\uDC8B\u200D\uD83E\uDDD1(?:\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])|\uD83C\uDFFC\u200D\u2764\u200D\uD83D\uDC8B\u200D\uD83E\uDDD1(?:\uD83C[\uDFFB\uDFFD-\uDFFF])|\uD83C\uDFFB\u200D\u2764\u200D\uD83D\uDC8B\u200D\uD83E\uDDD1(?:\uD83C[\uDFFC-\uDFFF]))|\uD83D\uDC68(?:\uD83C[\uDFFB-\uDFFF])\u200D\u2764\u200D\uD83D\uDC8B\u200D\uD83D\uDC68(?:\uD83C[\uDFFB-\uDFFF])|\uD83D\uDC69(?:\uD83C[\uDFFB-\uDFFF])\u200D\u2764\u200D\uD83D\uDC8B\u200D(?:\uD83D[\uDC68\uDC69])(?:\uD83C[\uDFFB-\uDFFF])|\uD83D\uDC68(?:\u200D\u2764\uFE0F\u200D\uD83D\uDC8B\u200D\uD83D\uDC68|(?:\uD83C[\uDFFB-\uDFFF])\u200D\u2764\uFE0F\u200D\uD83D\uDC68(?:\uD83C[\uDFFB-\uDFFF]))|\uD83E\uDDD1(?:\uD83C\uDFFF\u200D\u2764\uFE0F\u200D\uD83E\uDDD1(?:\uD83C[\uDFFB-\uDFFE])|\uD83C\uDFFE\u200D\u2764\uFE0F\u200D\uD83E\uDDD1(?:\uD83C[\uDFFB-\uDFFD\uDFFF])|\uD83C\uDFFD\u200D\u2764\uFE0F\u200D\uD83E\uDDD1(?:\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])|\uD83C\uDFFC\u200D\u2764\uFE0F\u200D\uD83E\uDDD1(?:\uD83C[\uDFFB\uDFFD-\uDFFF])|\uD83C\uDFFB\u200D\u2764\uFE0F\u200D\uD83E\uDDD1(?:\uD83C[\uDFFC-\uDFFF]))|\uD83D\uDC69\u200D\u2764\uFE0F\u200D\uD83D\uDC8B\u200D(?:\uD83D[\uDC68\uDC69])|\uD83D\uDC69(?:\uD83C[\uDFFB-\uDFFF])\u200D\u2764\uFE0F\u200D(?:\uD83D[\uDC68\uDC69])(?:\uD83C[\uDFFB-\uDFFF])|(?:\uD83C\uDFC3|\uD83D\uDEB6|\uD83E\uDDCE)(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2640\u2642]\uFE0F\u200D\u27A1\uFE0F|\uD83C\uDFF4\uDB40\uDC67\uDB40\uDC62(?:\uDB40\uDC77\uDB40\uDC6C\uDB40\uDC73|\uDB40\uDC73\uDB40\uDC63\uDB40\uDC74|\uDB40\uDC65\uDB40\uDC6E\uDB40\uDC67)\uDB40\uDC7F|\uD83E\uDDD1\u200D\uD83E\uDDD1\u200D\uD83E\uDDD2\u200D\uD83E\uDDD2|(?:\uD83D\uDC68\uD83C\uDFFF\u200D\uD83E\uDD1D\u200D\uD83D\uDC68|\uD83E\uDDD1\uD83C\uDFFF\u200D\u2764\u200D\uD83E\uDDD1)(?:\uD83C[\uDFFB-\uDFFE])|(?:\uD83D\uDC68\uD83C\uDFFE\u200D\uD83E\uDD1D\u200D\uD83D\uDC68|\uD83E\uDDD1\uD83C\uDFFE\u200D\u2764\u200D\uD83E\uDDD1)(?:\uD83C[\uDFFB-\uDFFD\uDFFF])|(?:\uD83D\uDC68\uD83C\uDFFD\u200D\uD83E\uDD1D\u200D\uD83D\uDC68|\uD83E\uDDD1\uD83C\uDFFD\u200D\u2764\u200D\uD83E\uDDD1)(?:\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])|(?:\uD83D\uDC68\uD83C\uDFFC\u200D\uD83E\uDD1D\u200D\uD83D\uDC68|\uD83E\uDDD1\uD83C\uDFFC\u200D\u2764\u200D\uD83E\uDDD1)(?:\uD83C[\uDFFB\uDFFD-\uDFFF])|(?:\uD83D\uDC68\uD83C\uDFFB\u200D\uD83E\uDD1D\u200D\uD83D\uDC68|\uD83E\uDDD1\uD83C\uDFFB\u200D\u2764\u200D\uD83E\uDDD1)(?:\uD83C[\uDFFC-\uDFFF])|\uD83D\uDC69(?:\u200D(?:\uD83D\uDC69\u200D(?:\uD83D\uDC66\u200D\uD83D\uDC66|\uD83D\uDC67\u200D(?:\uD83D[\uDC66\uDC67]))|\u2764\u200D\uD83D\uDC8B\u200D(?:\uD83D[\uDC68\uDC69]))|\uD83C\uDFFF\u200D\uD83E\uDD1D\u200D(?:\uD83D[\uDC68\uDC69])(?:\uD83C[\uDFFB-\uDFFE])|\uD83C\uDFFE\u200D\uD83E\uDD1D\u200D(?:\uD83D[\uDC68\uDC69])(?:\uD83C[\uDFFB-\uDFFD\uDFFF])|\uD83C\uDFFD\u200D\uD83E\uDD1D\u200D(?:\uD83D[\uDC68\uDC69])(?:\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])|\uD83C\uDFFC\u200D\uD83E\uDD1D\u200D(?:\uD83D[\uDC68\uDC69])(?:\uD83C[\uDFFB\uDFFD-\uDFFF])|\uD83C\uDFFB\u200D(?:\uD83E\uDD1D\u200D(?:\uD83D[\uDC68\uDC69])(?:\uD83C[\uDFFC-\uDFFF])|(?:\uD83E[\uDDAF\uDDBC\uDDBD])\u200D\u27A1\uFE0F|\u2764\u200D(?:\uD83D[\uDC68\uDC69])(?:\uD83C[\uDFFB-\uDFFF]))|(?:\uD83C\uDFFF\u200D(?:\uD83E[\uDDAF\uDDBC\uDDBD])|\uD83C\uDFFE\u200D(?:\uD83E[\uDDAF\uDDBC\uDDBD])|\uD83C\uDFFD\u200D(?:\uD83E[\uDDAF\uDDBC\uDDBD])|\uD83C\uDFFC\u200D(?:\uD83E[\uDDAF\uDDBC\uDDBD]))\u200D\u27A1\uFE0F|(?:\uD83C[\uDFFC-\uDFFF])\u200D\u2764\u200D(?:\uD83D[\uDC68\uDC69])(?:\uD83C[\uDFFB-\uDFFF]))|\uD83D\uDC68\u200D\u2764\u200D\uD83D\uDC8B\u200D\uD83D\uDC68|\uD83D\uDC68\u200D(?:\uD83D[\uDC68\uDC69])\u200D(?:\uD83D\uDC66\u200D\uD83D\uDC66|\uD83D\uDC67\u200D(?:\uD83D[\uDC66\uDC67]))|(?:\uD83E\uDDD1(?:\uD83C[\uDFFB-\uDFFF])\u200D\uD83E\uDD1D\u200D\uD83E\uDDD1|\uD83D\uDC68(?:\uD83C[\uDFFB-\uDFFF])\u200D\u2764\u200D\uD83D\uDC68)(?:\uD83C[\uDFFB-\uDFFF])|(?:\uD83E\uDDD1(?:\uD83C\uDFFF\u200D(?:\uD83E[\uDDAF\uDDBC\uDDBD])|\uD83C\uDFFE\u200D(?:\uD83E[\uDDAF\uDDBC\uDDBD])|\uD83C\uDFFD\u200D(?:\uD83E[\uDDAF\uDDBC\uDDBD])|\uD83C\uDFFC\u200D(?:\uD83E[\uDDAF\uDDBC\uDDBD])|\uD83C\uDFFB\u200D(?:\uD83E[\uDDAF\uDDBC\uDDBD]))|\uD83D\uDC68(?:\uD83C\uDFFF\u200D(?:\uD83E[\uDDAF\uDDBC\uDDBD])|\uD83C\uDFFE\u200D(?:\uD83E[\uDDAF\uDDBC\uDDBD])|\uD83C\uDFFD\u200D(?:\uD83E[\uDDAF\uDDBC\uDDBD])|\uD83C\uDFFC\u200D(?:\uD83E[\uDDAF\uDDBC\uDDBD])|\uD83C\uDFFB\u200D(?:\uD83E[\uDDAF\uDDBC\uDDBD]))|(?:\uD83C\uDFC3|\uD83D\uDEB6|\uD83E\uDDCE)\u200D[\u2640\u2642]\uFE0F)\u200D\u27A1\uFE0F|(?:\uD83C\uDFC3|\uD83D\uDEB6|\uD83E\uDDCE)(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2640\u2642]\uFE0F\u200D\u27A1|(?:\uD83C\uDFC3|\uD83D\uDEB6|\uD83E\uDDCE)(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2640\u2642]\u200D\u27A1\uFE0F|\uD83D\uDC68(?:\u200D(?:\u2764\uFE0F\u200D\uD83D\uDC68|(?:\uD83E[\uDDAF\uDDBC\uDDBD])\u200D\u27A1\uFE0F)|(?:\uD83C[\uDFFB-\uDFFF])\u200D(?:\uD83E[\uDDAF\uDDBC\uDDBD])\u200D\u27A1)|\uD83D\uDC69\u200D\u2764\uFE0F\u200D(?:\uD83D[\uDC68\uDC69])|(?:\uD83E\uDDD1(?:\uD83C[\uDFFB-\uDFFF])|\uD83D\uDC69(?:\uD83C[\uDFFB-\uDFFF]))\u200D(?:\uD83E[\uDDAF\uDDBC\uDDBD])\u200D\u27A1|(?:\uD83E\uDDD1\u200D(?:\uD83E[\uDDAF\uDDBC\uDDBD])|\uD83D\uDC69\u200D(?:\uD83E[\uDDAF\uDDBC\uDDBD]))\u200D\u27A1\uFE0F|(?:\uD83C\uDFC3|\uD83D\uDEB6|\uD83E\uDDCE)(?:(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2640\u2642]|\u200D[\u2640\u2642]\uFE0F)\u200D\u27A1|(?:\uD83C\uDFC3|\uD83D\uDEB6|\uD83E\uDDCE)\u200D[\u2640\u2642]\u200D\u27A1\uFE0F|\uD83E\uDDD1\u200D(?:\uD83E\uDD1D\u200D\uD83E\uDDD1|(?:\uD83E[\uDDD1\uDDD2])\u200D\uD83E\uDDD2)|\uD83D\uDC69\u200D\uD83D\uDC66\u200D\uD83D\uDC66|\uD83D\uDC68(?:\u200D(?:\uD83D\uDC66\u200D\uD83D\uDC66|\u2764\u200D\uD83D\uDC68|(?:\uD83E[\uDDAF\uDDBC\uDDBD])\u200D\u27A1|(?:\uD83D[\uDC67-\uDC69])\u200D(?:\uD83D[\uDC66\uDC67]))|(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2695\u2696\u2708]\uFE0F)|\uD83E\uDEF1(?:\uD83C\uDFFF\u200D\uD83E\uDEF2(?:\uD83C[\uDFFB-\uDFFE])|\uD83C\uDFFE\u200D\uD83E\uDEF2(?:\uD83C[\uDFFB-\uDFFD\uDFFF])|\uD83C\uDFFD\u200D\uD83E\uDEF2(?:\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])|\uD83C\uDFFC\u200D\uD83E\uDEF2(?:\uD83C[\uDFFB\uDFFD-\uDFFF])|\uD83C\uDFFB\u200D\uD83E\uDEF2(?:\uD83C[\uDFFC-\uDFFF]))|(?:\uD83D\uDC41\uFE0F\u200D\uD83D\uDDE8|\uD83C\uDFF3\uFE0F\u200D\u26A7|(?:\uD83C[\uDFC4\uDFCA]|\uD83D[\uDC6E\uDC70\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4\uDEB5]|\uD83E[\uDD26\uDD35\uDD37-\uDD39\uDD3D\uDD3E\uDDB8\uDDB9\uDDCD\uDDCF\uDDD4\uDDD6-\uDDDD])(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2640\u2642]|(?:\u26F9|\uD83C[\uDFCB\uDFCC]|\uD83D\uDD75)(?:\uFE0F|\uD83C[\uDFFB-\uDFFF])\u200D[\u2640\u2642]|(?:\uD83C\uDFC3|\uD83D\uDEB6|\uD83E\uDDCE)(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2640\u2642\u27A1])\uFE0F|\uD83D\uDC69\u200D\u2764\u200D(?:\uD83D[\uDC68\uDC69])|(?:\uD83E\uDDD1(?:\uD83C[\uDFFB-\uDFFF])|\uD83D\uDC69(?:\uD83C[\uDFFB-\uDFFF]))\u200D[\u2695\u2696\u2708]\uFE0F|(?:\uD83E\uDDD1\u200D(?:\uD83E[\uDDAF\uDDBC\uDDBD])|\uD83D\uDC69\u200D(?:\uD83E[\uDDAF\uDDBC\uDDBD])|(?:\uD83C\uDFC3|\uD83D\uDEB6|\uD83E\uDDCE)\u200D[\u2640\u2642])\u200D\u27A1|\uD83D\uDC69\u200D(?:\uD83D[\uDC67\uDC69])\u200D(?:\uD83D[\uDC66\uDC67])|\uD83D\uDC41\uFE0F\u200D\uD83D\uDDE8|(?:\uD83D\uDE36\u200D\uD83C\uDF2B|\uD83D\uDC41\u200D\uD83D\uDDE8|\uD83D\uDE42\u200D[\u2194\u2195]|\uD83D\uDC3B\u200D\u2744|\uD83C\uDFF4\u200D\u2620|\uD83C\uDFF3\u200D\u26A7|\uD83E\uDDD1\u200D[\u2695\u2696\u2708]|(?:\uD83C[\uDFC4\uDFCA]|\uD83D[\uDC6E-\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4\uDEB5]|\uD83E[\uDD26\uDD35\uDD37-\uDD39\uDD3C-\uDD3E\uDDB8\uDDB9\uDDCD\uDDCF\uDDD4\uDDD6-\uDDDF])\u200D[\u2640\u2642]|(?:\u26F9|\uD83C[\uDFCB\uDFCC]|\uD83D\uDD75)\u200D[\u2640\u2642]|(?:\uD83D[\uDC68\uDC69])\u200D[\u2695\u2696\u2708])\uFE0F|\uD83C\uDFF3\uFE0F\u200D(?:\u26A7|\uD83C\uDF08)|\u26D3\uFE0F\u200D\uD83D\uDCA5|\uD83E\uDDD1(?:\uD83C[\uDFFB-\uDFFF])\u200D(?:[\u2695\u2696\u2708]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\u2764\uFE0F\u200D(?:\uD83D\uDD25|\uD83E\uDE79)|(?:\uD83C[\uDFC4\uDFCA]|\uD83D[\uDC6E\uDC70\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4\uDEB5]|\uD83E[\uDD26\uDD35\uDD37-\uDD39\uDD3D\uDD3E\uDDB8\uDDB9\uDDCD\uDDCF\uDDD4\uDDD6-\uDDDD])(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2640\u2642]|(?:\u26F9|\uD83C[\uDFCB\uDFCC]|\uD83D\uDD75)(?:\uFE0F|\uD83C[\uDFFB-\uDFFF])\u200D[\u2640\u2642]|(?:\uD83D[\uDC68\uDC69])(?:\uD83C[\uDFFB-\uDFFF])\u200D(?:[\u2695\u2696\u2708]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|(?:\uD83C\uDFC3|\uD83D\uDEB6|\uD83E\uDDCE)(?:(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2640\u2642\u27A1]|\u200D[\u2640\u2642\u27A1]\uFE0F)|\uD83D\uDE36\u200D\uD83C\uDF2B|\uD83D\uDE35\u200D\uD83D\uDCAB|\uD83D\uDE2E\u200D\uD83D\uDCA8|\uD83D\uDC41\u200D\uD83D\uDDE8|\uD83D\uDC15\u200D\uD83E\uDDBA|\uD83C\uDF4B\u200D\uD83D\uDFE9|\uD83C\uDF44\u200D\uD83D\uDFEB|\uD83D\uDE42\u200D[\u2194\u2195]|\uD83D\uDC3B\u200D\u2744|\uD83D\uDC26\u200D(?:\u2B1B|\uD83D\uDD25)|\uD83D\uDC08\u200D\u2B1B|\uD83C\uDFF4\u200D\u2620|\uD83C\uDFF3\u200D(?:\u26A7|\uD83C\uDF08)|\u26D3\u200D\uD83D\uDCA5|\uD83E\uDDD1\u200D(?:[\u2695\u2696\u2708]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD\uDDD2])|\u2764\u200D(?:\uD83D\uDD25|\uD83E\uDE79)|(?:\u26F9|\uD83C[\uDFC4\uDFCA-\uDFCC]|\uD83D[\uDC6E-\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDD75\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4\uDEB5]|\uD83E[\uDD26\uDD35\uDD37-\uDD39\uDD3C-\uDD3E\uDDB8\uDDB9\uDDCD\uDDCF\uDDD4\uDDD6-\uDDDF])\u200D[\u2640\u2642]|(?:\uD83C\uDFC3|\uD83D\uDEB6|\uD83E\uDDCE)\u200D[\u2640\u2642\u27A1]|(?:\uD83D[\uDC68\uDC69])\u200D(?:[\u2695\u2696\u2708]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDC66\uDC67\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|[#\*0-9]\uFE0F\u20E3|\uD83C\uDDFD\uD83C\uDDF0|\uD83C\uDDF6\uD83C\uDDE6|\uD83C\uDDF4\uD83C\uDDF2|\uD83C\uDDFF(?:\uD83C[\uDDE6\uDDF2\uDDFC])|\uD83C\uDDFE(?:\uD83C[\uDDEA\uDDF9])|\uD83C\uDDFC(?:\uD83C[\uDDEB\uDDF8])|\uD83C\uDDFB(?:\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDEE\uDDF3\uDDFA])|\uD83C\uDDFA(?:\uD83C[\uDDE6\uDDEC\uDDF2\uDDF3\uDDF8\uDDFE\uDDFF])|\uD83C\uDDF9(?:\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDED\uDDEF-\uDDF4\uDDF7\uDDF9\uDDFB\uDDFC\uDDFF])|\uD83C\uDDF8(?:\uD83C[\uDDE6-\uDDEA\uDDEC-\uDDF4\uDDF7-\uDDF9\uDDFB\uDDFD-\uDDFF])|\uD83C\uDDF7(?:\uD83C[\uDDEA\uDDF4\uDDF8\uDDFA\uDDFC])|\uD83C\uDDF5(?:\uD83C[\uDDE6\uDDEA-\uDDED\uDDF0-\uDDF3\uDDF7-\uDDF9\uDDFC\uDDFE])|\uD83C\uDDF3(?:\uD83C[\uDDE6\uDDE8\uDDEA-\uDDEC\uDDEE\uDDF1\uDDF4\uDDF5\uDDF7\uDDFA\uDDFF])|\uD83C\uDDF2(?:\uD83C[\uDDE6\uDDE8-\uDDED\uDDF0-\uDDFF])|\uD83C\uDDF1(?:\uD83C[\uDDE6-\uDDE8\uDDEE\uDDF0\uDDF7-\uDDFB\uDDFE])|\uD83C\uDDF0(?:\uD83C[\uDDEA\uDDEC-\uDDEE\uDDF2\uDDF3\uDDF5\uDDF7\uDDFC\uDDFE\uDDFF])|\uD83C\uDDEF(?:\uD83C[\uDDEA\uDDF2\uDDF4\uDDF5])|\uD83C\uDDEE(?:\uD83C[\uDDE8-\uDDEA\uDDF1-\uDDF4\uDDF6-\uDDF9])|\uD83C\uDDED(?:\uD83C[\uDDF0\uDDF2\uDDF3\uDDF7\uDDF9\uDDFA])|\uD83C\uDDEC(?:\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEE\uDDF1-\uDDF3\uDDF5-\uDDFA\uDDFC\uDDFE])|\uD83C\uDDEB(?:\uD83C[\uDDEE-\uDDF0\uDDF2\uDDF4\uDDF7])|\uD83C\uDDEA(?:\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDED\uDDF7-\uDDFA])|\uD83C\uDDE9(?:\uD83C[\uDDEA\uDDEC\uDDEF\uDDF0\uDDF2\uDDF4\uDDFF])|\uD83C\uDDE8(?:\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDEE\uDDF0-\uDDF5\uDDF7\uDDFA-\uDDFF])|\uD83C\uDDE7(?:\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEF\uDDF1-\uDDF4\uDDF6-\uDDF9\uDDFB\uDDFC\uDDFE\uDDFF])|\uD83C\uDDE6(?:\uD83C[\uDDE8-\uDDEC\uDDEE\uDDF1\uDDF2\uDDF4\uDDF6-\uDDFA\uDDFC\uDDFD\uDDFF])|[#\*0-9]\u20E3|(?:\uD83C[\uDF85\uDFC3\uDFC7]|\uD83D[\uDC43\uDC4A-\uDC4C\uDC4F\uDC50\uDC66-\uDC69\uDC6B-\uDC6E\uDC70-\uDC78\uDC7C\uDC81-\uDC83\uDC85-\uDC87\uDC8F\uDC91\uDCAA\uDD7A\uDD95\uDD96\uDE45-\uDE47\uDE4B-\uDE4F\uDEA3\uDEB4-\uDEB6\uDEC0\uDECC]|\uD83E[\uDD0C\uDD0F\uDD18-\uDD1F\uDD26\uDD30-\uDD39\uDD3D\uDD3E\uDD77\uDDB5\uDDB6\uDDB8\uDDB9\uDDBB\uDDCD-\uDDCF\uDDD1-\uDDDD\uDEC3-\uDEC5\uDEF0-\uDEF8])(?:\uD83C[\uDFFB-\uDFFF])|(?:[\u261D\u26F9\u270A-\u270D]|\uD83C[\uDFC2\uDFC4\uDFCA-\uDFCC]|\uD83D[\uDC42\uDC46-\uDC49\uDC4D\uDC4E\uDD74\uDD75\uDD90])(?:[\uFE0E\uFE0F]|\uD83C[\uDFFB-\uDFFF])|(?:[\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u2648-\u2653\u265F\u2660\u2663\u2665\u2666\u2668\u267B\u267E\u267F\u2692-\u2697\u2699\u269B\u269C\u26A0\u26A1\u26A7\u26AA\u26AB\u26B0\u26B1\u26BD\u26BE\u26C4\u26C5\u26C8\u26CE\u26CF\u26D1\u26D3\u26D4\u26E9\u26EA\u26F0-\u26F5\u26F7\u26F8\u26FA\u26FD\u2702\u2705\u2708\u2709\u270F\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763\u2764\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299]|\uD83C[\uDC04\uDD70\uDD71\uDD7E\uDD7F\uDE02\uDE1A\uDE2F\uDE37\uDF0D-\uDF0F\uDF15\uDF1C\uDF21\uDF24-\uDF2C\uDF36\uDF78\uDF7D\uDF93\uDF96\uDF97\uDF99-\uDF9B\uDF9E\uDF9F\uDFA7\uDFAC-\uDFAE\uDFC6\uDFCD\uDFCE\uDFD4-\uDFE0\uDFED\uDFF3\uDFF5\uDFF7]|\uD83D[\uDC08\uDC15\uDC1F\uDC26\uDC3F\uDC41\uDC53\uDC6A\uDC7D\uDCA3\uDCB0\uDCB3\uDCBB\uDCBF\uDCCB\uDCDA\uDCDF\uDCE4-\uDCE6\uDCEA-\uDCED\uDCF7\uDCF9-\uDCFB\uDCFD\uDD08\uDD0D\uDD12\uDD13\uDD49\uDD4A\uDD50-\uDD67\uDD6F\uDD70\uDD73\uDD76-\uDD79\uDD87\uDD8A-\uDD8D\uDDA5\uDDA8\uDDB1\uDDB2\uDDBC\uDDC2-\uDDC4\uDDD1-\uDDD3\uDDDC-\uDDDE\uDDE1\uDDE3\uDDE8\uDDEF\uDDF3\uDDFA\uDE10\uDE87\uDE8D\uDE91\uDE94\uDE98\uDEAD\uDEB2\uDEB9\uDEBA\uDEBC\uDECB\uDECD-\uDECF\uDEE0-\uDEE5\uDEE9\uDEF0\uDEF3])[\uFE0E\uFE0F]|[\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u261D\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u2648-\u2653\u265F\u2660\u2663\u2665\u2666\u2668\u267B\u267E\u267F\u2692-\u2697\u2699\u269B\u269C\u26A0\u26A1\u26A7\u26AA\u26AB\u26B0\u26B1\u26BD\u26BE\u26C4\u26C5\u26C8\u26CE\u26CF\u26D1\u26D3\u26D4\u26E9\u26EA\u26F0-\u26F5\u26F7-\u26FA\u26FD\u2702\u2705\u2708-\u270D\u270F\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763\u2764\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299]|\uD83C[\uDC04\uDCCF\uDD70\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDD9A\uDDE6-\uDDFF\uDE01\uDE02\uDE1A\uDE2F\uDE32-\uDE3A\uDE50\uDE51\uDF00-\uDF21\uDF24-\uDF93\uDF96\uDF97\uDF99-\uDF9B\uDF9E-\uDFF0\uDFF3-\uDFF5\uDFF7-\uDFFF]|\uD83D[\uDC00-\uDCFD\uDCFF-\uDD3D\uDD49-\uDD4E\uDD50-\uDD67\uDD6F\uDD70\uDD73-\uDD7A\uDD87\uDD8A-\uDD8D\uDD90\uDD95\uDD96\uDDA4\uDDA5\uDDA8\uDDB1\uDDB2\uDDBC\uDDC2-\uDDC4\uDDD1-\uDDD3\uDDDC-\uDDDE\uDDE1\uDDE3\uDDE8\uDDEF\uDDF3\uDDFA-\uDE4F\uDE80-\uDEC5\uDECB-\uDED2\uDED5-\uDED7\uDEDC-\uDEE5\uDEE9\uDEEB\uDEEC\uDEF0\uDEF3-\uDEFC\uDFE0-\uDFEB\uDFF0]|\uD83E[\uDD0C-\uDD3A\uDD3C-\uDD45\uDD47-\uDDFF\uDE70-\uDE7C\uDE80-\uDE88\uDE90-\uDEBD\uDEBF-\uDEC5\uDECE-\uDEDB\uDEE0-\uDEE8\uDEF0-\uDEF8]/;const Ge=le(Xe);/*!
 * element-emotes
 * Copyright (C) 2022-present  Michael Serajnik  https://github.com/mserajnik
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */let T,K;const Ye=u=>{for(const e of p.get("emotes"))u=u.split(`:${e.name}:`).join("");return u},Je=u=>(u=Ye(u.replace(/\s/g,"").replace(/[\u200D\u2003]/g,"").replace(new RegExp(Ge.source,"gi"),"")),u.trim()===""),Ze=u=>u.match(/^.+\/emotes\/.+\.(gif|apng)(\?.+)?$/)?u.split("/emotes/").join("/frozen-emotes/"):null,pe=(u=!1)=>{const e=document.querySelectorAll("[data-frozen-emote-url]");if(e.length)for(const t of e){if(u){t.src=t.dataset.frozenEmoteUrl;continue}t.src=t.dataset.emoteUrl}},ge=(u,e=!1)=>{if(u.dataset.emotesReplaced&&!e)return;const t=u.querySelector(".mx_EventTile_body");if(!t)return;let D=t.innerHTML;const n=Je(t.textContent)?`max-height:${p.get("largeEmoteSize")};vertical-align:bottom`:`max-height:${p.get("defaultEmoteSize")}`;for(const r of p.get("emotes")){const s=Ze(r.url);D=D.split(`:${r.name}:`).join(`<img
          style="${n}"`+(K&&s?document.hasFocus()?`src="${r.url}?accessKey=${T}"`:`src="${s}?accessKey=${T}"`:`src="${r.url}?accessKey=${T}"`)+`data-emote-url="${r.url}?accessKey=${T}"`+(K&&s?`data-frozen-emote-url="${s}?accessKey=${T}"`:"")+`alt="${r.name}"
          title="${r.name}">`)}t.innerHTML=D,u.dataset.emotesReplaced=!0},be=u=>{if(u.classList&&u.classList.contains("mx_EventTile_content")){ge(u);return}if(u.classList&&u.classList.contains("mx_EventTile_edited")){ge(u.parentNode,!0);return}u.childNodes&&[...u.childNodes].forEach(be)},qe={initialize:()=>{T=p.get("accessKey"),K=p.get("useFrozenEmotes"),new window.MutationObserver(u=>{for(const e of u)for(const t of e.addedNodes)be(t)}).observe(document.body,{childList:!0,subtree:!0}),K&&(window.focus(),window.addEventListener("focus",()=>{pe(!1)}),window.addEventListener("blur",()=>{pe(!0)}))}};var V={},$={},Se={exports:{}};(function(u){var e=Object.prototype.hasOwnProperty,t="~";function D(){}Object.create&&(D.prototype=Object.create(null),new D().__proto__||(t=!1));function n(o,c,a){this.fn=o,this.context=c,this.once=a||!1}function r(o,c,a,l,F){if(typeof a!="function")throw new TypeError("The listener must be a function");var d=new n(a,l||o,F),E=t?t+c:c;return o._events[E]?o._events[E].fn?o._events[E]=[o._events[E],d]:o._events[E].push(d):(o._events[E]=d,o._eventsCount++),o}function s(o,c){--o._eventsCount===0?o._events=new D:delete o._events[c]}function i(){this._events=new D,this._eventsCount=0}i.prototype.eventNames=function(){var c=[],a,l;if(this._eventsCount===0)return c;for(l in a=this._events)e.call(a,l)&&c.push(t?l.slice(1):l);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(a)):c},i.prototype.listeners=function(c){var a=t?t+c:c,l=this._events[a];if(!l)return[];if(l.fn)return[l.fn];for(var F=0,d=l.length,E=new Array(d);F<d;F++)E[F]=l[F].fn;return E},i.prototype.listenerCount=function(c){var a=t?t+c:c,l=this._events[a];return l?l.fn?1:l.length:0},i.prototype.emit=function(c,a,l,F,d,E){var m=t?t+c:c;if(!this._events[m])return!1;var C=this._events[m],g=arguments.length,B,f;if(C.fn){switch(C.once&&this.removeListener(c,C.fn,void 0,!0),g){case 1:return C.fn.call(C.context),!0;case 2:return C.fn.call(C.context,a),!0;case 3:return C.fn.call(C.context,a,l),!0;case 4:return C.fn.call(C.context,a,l,F),!0;case 5:return C.fn.call(C.context,a,l,F,d),!0;case 6:return C.fn.call(C.context,a,l,F,d,E),!0}for(f=1,B=new Array(g-1);f<g;f++)B[f-1]=arguments[f];C.fn.apply(C.context,B)}else{var I=C.length,L;for(f=0;f<I;f++)switch(C[f].once&&this.removeListener(c,C[f].fn,void 0,!0),g){case 1:C[f].fn.call(C[f].context);break;case 2:C[f].fn.call(C[f].context,a);break;case 3:C[f].fn.call(C[f].context,a,l);break;case 4:C[f].fn.call(C[f].context,a,l,F);break;default:if(!B)for(L=1,B=new Array(g-1);L<g;L++)B[L-1]=arguments[L];C[f].fn.apply(C[f].context,B)}}return!0},i.prototype.on=function(c,a,l){return r(this,c,a,l,!1)},i.prototype.once=function(c,a,l){return r(this,c,a,l,!0)},i.prototype.removeListener=function(c,a,l,F){var d=t?t+c:c;if(!this._events[d])return this;if(!a)return s(this,d),this;var E=this._events[d];if(E.fn)E.fn===a&&(!F||E.once)&&(!l||E.context===l)&&s(this,d);else{for(var m=0,C=[],g=E.length;m<g;m++)(E[m].fn!==a||F&&!E[m].once||l&&E[m].context!==l)&&C.push(E[m]);C.length?this._events[d]=C.length===1?C[0]:C:s(this,d)}return this},i.prototype.removeAllListeners=function(c){var a;return c?(a=t?t+c:c,this._events[a]&&s(this,a)):(this._events=new D,this._eventsCount=0),this},i.prototype.off=i.prototype.removeListener,i.prototype.addListener=i.prototype.on,i.prefixed=t,i.EventEmitter=i,u.exports=i})(Se);var X=Se.exports,Fe={},z={};Object.defineProperty(z,"__esModule",{value:!0});z.SearchResult=void 0;const eu=/\$&/g,uu=/\$(\d)/g;class tu{constructor(e,t,D){this.data=e,this.term=t,this.strategy=D}getReplacementData(e){let t=this.strategy.replace(this.data);if(t==null)return null;let D="";Array.isArray(t)&&(D=t[1],t=t[0]);const n=this.strategy.match(e);if(n==null||n.index==null)return null;const r=t.replace(eu,n[0]).replace(uu,(s,i)=>n[parseInt(i)]);return{start:n.index,end:n.index+n[0].length,beforeCursor:r,afterCursor:D}}replace(e,t){const D=this.getReplacementData(e);if(D!==null)return t=D.afterCursor+t,[[e.slice(0,D.start),D.beforeCursor,e.slice(D.end)].join(""),t]}render(){return this.strategy.renderTemplate(this.data,this.term)}getStrategyId(){return this.strategy.getId()}}z.SearchResult=tu;(function(u){Object.defineProperty(u,"__esModule",{value:!0}),u.Strategy=u.DEFAULT_INDEX=void 0;const e=z;u.DEFAULT_INDEX=1;class t{constructor(n){this.props=n,this.cache={}}destroy(){return this.cache={},this}replace(n){return this.props.replace(n)}execute(n,r){var s;const i=this.matchWithContext(n);if(!i)return!1;const o=i[(s=this.props.index)!==null&&s!==void 0?s:u.DEFAULT_INDEX];return this.search(o,c=>{r(c.map(a=>new e.SearchResult(a,o,this)))},i),!0}renderTemplate(n,r){if(this.props.template)return this.props.template(n,r);if(typeof n=="string")return n;throw new Error(`Unexpected render data type: ${typeof n}. Please implement template parameter by yourself`)}getId(){return this.props.id||null}match(n){return typeof this.props.match=="function"?this.props.match(n):n.match(this.props.match)}search(n,r,s){this.props.cache?this.searchWithCach(n,r,s):this.props.search(n,r,s)}matchWithContext(n){const r=this.context(n);return r===!1?null:this.match(r===!0?n:r)}context(n){return this.props.context?this.props.context(n):!0}searchWithCach(n,r,s){this.cache[n]!=null?r(this.cache[n]):this.props.search(n,i=>{this.cache[n]=i,r(i)},s)}}u.Strategy=t})(Fe);Object.defineProperty($,"__esModule",{value:!0});$.Completer=void 0;const Du=X,nu=Fe;class su extends Du.EventEmitter{constructor(e){super(),this.handleQueryResult=t=>{this.emit("hit",{searchResults:t})},this.strategies=e.map(t=>new nu.Strategy(t))}destroy(){return this.strategies.forEach(e=>e.destroy()),this}run(e){for(const t of this.strategies)if(t.execute(e,this.handleQueryResult))return;this.handleQueryResult([])}}$.Completer=su;var he={},R={};Object.defineProperty(R,"__esModule",{value:!0});R.createCustomEvent=void 0;const ru=typeof window<"u"&&!!window.CustomEvent,iu=(u,e)=>{if(ru)return new CustomEvent(u,e);const t=document.createEvent("CustomEvent");return t.initCustomEvent(u,!1,(e==null?void 0:e.cancelable)||!1,(e==null?void 0:e.detail)||void 0),t};R.createCustomEvent=iu;(function(u){Object.defineProperty(u,"__esModule",{value:!0}),u.Dropdown=u.DEFAULT_DROPDOWN_ITEM_ACTIVE_CLASS_NAME=u.DEFAULT_DROPDOWN_ITEM_CLASS_NAME=u.DEFAULT_DROPDOWN_CLASS_NAME=u.DEFAULT_DROPDOWN_PLACEMENT=u.DEFAULT_DROPDOWN_MAX_COUNT=void 0;const e=X,t=R;u.DEFAULT_DROPDOWN_MAX_COUNT=10,u.DEFAULT_DROPDOWN_PLACEMENT="auto",u.DEFAULT_DROPDOWN_CLASS_NAME="dropdown-menu textcomplete-dropdown",u.DEFAULT_DROPDOWN_ITEM_CLASS_NAME="textcomplete-item",u.DEFAULT_DROPDOWN_ITEM_ACTIVE_CLASS_NAME=`${u.DEFAULT_DROPDOWN_ITEM_CLASS_NAME} active`;class D extends e.EventEmitter{static create(s){const i=document.createElement("ul");i.className=s.className||u.DEFAULT_DROPDOWN_CLASS_NAME,Object.assign(i.style,{display:"none",position:"absolute",zIndex:"1000"},s.style);const o=s.parent||document.body;return o==null||o.appendChild(i),new D(i,s)}constructor(s,i){super(),this.el=s,this.option=i,this.shown=!1,this.items=[],this.activeIndex=null}render(s,i){const o=(0,t.createCustomEvent)("render",{cancelable:!0});return this.emit("render",o),o.defaultPrevented?this:(this.clear(),s.length===0?this.hide():(this.items=s.slice(0,this.option.maxCount||u.DEFAULT_DROPDOWN_MAX_COUNT).map((c,a)=>{var l;return new n(this,a,c,((l=this.option)===null||l===void 0?void 0:l.item)||{})}),this.setStrategyId(s[0]).renderEdge(s,"header").renderItems().renderEdge(s,"footer").show().setOffset(i).activate(0),this.emit("rendered",(0,t.createCustomEvent)("rendered")),this))}destroy(){var s;return this.clear(),(s=this.el.parentNode)===null||s===void 0||s.removeChild(this.el),this}select(s){const i={searchResult:s.searchResult},o=(0,t.createCustomEvent)("select",{cancelable:!0,detail:i});return this.emit("select",o),o.defaultPrevented?this:(this.hide(),this.emit("selected",(0,t.createCustomEvent)("selected",{detail:i})),this)}show(){if(!this.shown){const s=(0,t.createCustomEvent)("show",{cancelable:!0});if(this.emit("show",s),s.defaultPrevented)return this;this.el.style.display="block",this.shown=!0,this.emit("shown",(0,t.createCustomEvent)("shown"))}return this}hide(){if(this.shown){const s=(0,t.createCustomEvent)("hide",{cancelable:!0});if(this.emit("hide",s),s.defaultPrevented)return this;this.el.style.display="none",this.shown=!1,this.clear(),this.emit("hidden",(0,t.createCustomEvent)("hidden"))}return this}clear(){return this.items.forEach(s=>s.destroy()),this.items=[],this.el.innerHTML="",this.activeIndex=null,this}up(s){return this.shown?this.moveActiveItem("prev",s):this}down(s){return this.shown?this.moveActiveItem("next",s):this}moveActiveItem(s,i){if(this.activeIndex!=null){const o=s==="next"?this.getNextActiveIndex():this.getPrevActiveIndex();o!=null&&(this.activate(o),i.preventDefault())}return this}activate(s){return this.activeIndex!==s&&(this.activeIndex!=null&&this.items[this.activeIndex].deactivate(),this.activeIndex=s,this.items[s].activate()),this}isShown(){return this.shown}getActiveItem(){return this.activeIndex!=null?this.items[this.activeIndex]:null}setOffset(s){const i=document.documentElement;if(i){const o=this.el.offsetWidth;if(s.left){const l=this.option.dynamicWidth?i.scrollWidth:i.clientWidth;s.left+o>l&&(s.left=l-o),this.el.style.left=`${s.left}px`}else s.right&&(s.right-o<0&&(s.right=0),this.el.style.right=`${s.right}px`);let c=!1;const a=this.option.placement||u.DEFAULT_DROPDOWN_PLACEMENT;if(a==="auto"){const l=this.items.length*s.lineHeight;c=s.clientTop!=null&&s.clientTop+l>i.clientHeight}a==="top"||c?(this.el.style.bottom=`${i.clientHeight-s.top+s.lineHeight}px`,this.el.style.top="auto"):(this.el.style.top=`${s.top}px`,this.el.style.bottom="auto")}return this}getNextActiveIndex(){if(this.activeIndex==null)throw new Error;return this.activeIndex<this.items.length-1?this.activeIndex+1:this.option.rotate?0:null}getPrevActiveIndex(){if(this.activeIndex==null)throw new Error;return this.activeIndex!==0?this.activeIndex-1:this.option.rotate?this.items.length-1:null}renderItems(){const s=document.createDocumentFragment();for(const i of this.items)s.appendChild(i.el);return this.el.appendChild(s),this}setStrategyId(s){const i=s.getStrategyId();return i&&(this.el.dataset.strategy=i),this}renderEdge(s,i){const o=this.option[i],c=document.createElement("li");return c.className=`textcomplete-${i}`,c.innerHTML=typeof o=="function"?o(s.map(a=>a.data)):o||"",this.el.appendChild(c),this}}u.Dropdown=D;class n{constructor(s,i,o,c){this.dropdown=s,this.index=i,this.searchResult=o,this.props=c,this.active=!1,this.onClick=F=>{F.preventDefault(),this.dropdown.select(this)},this.className=this.props.className||u.DEFAULT_DROPDOWN_ITEM_CLASS_NAME,this.activeClassName=this.props.activeClassName||u.DEFAULT_DROPDOWN_ITEM_ACTIVE_CLASS_NAME;const a=document.createElement("li");a.className=this.active?this.activeClassName:this.className;const l=document.createElement("span");l.tabIndex=-1,l.innerHTML=this.searchResult.render(),a.appendChild(l),a.addEventListener("click",this.onClick),this.el=a}destroy(){var s;const i=this.el;return(s=i.parentNode)===null||s===void 0||s.removeChild(i),i.removeEventListener("click",this.onClick,!1),this}activate(){return this.active||(this.active=!0,this.el.className=this.activeClassName,this.dropdown.el.scrollTop=this.el.offsetTop),this}deactivate(){return this.active&&(this.active=!1,this.el.className=this.className),this}}})(he);var G={};Object.defineProperty(G,"__esModule",{value:!0});G.Editor=void 0;const ou=X,W=R;class cu extends ou.EventEmitter{destroy(){return this}applySearchResult(e){throw new Error("Not implemented.")}getCursorOffset(){throw new Error("Not implemented.")}getBeforeCursor(){throw new Error("Not implemented.")}emitMoveEvent(e){const t=(0,W.createCustomEvent)("move",{cancelable:!0,detail:{code:e}});return this.emit("move",t),t}emitEnterEvent(){const e=(0,W.createCustomEvent)("enter",{cancelable:!0});return this.emit("enter",e),e}emitChangeEvent(){const e=(0,W.createCustomEvent)("change",{detail:{beforeCursor:this.getBeforeCursor()}});return this.emit("change",e),e}emitEscEvent(){const e=(0,W.createCustomEvent)("esc",{cancelable:!0});return this.emit("esc",e),e}getCode(e){switch(e.keyCode){case 9:case 13:return"ENTER";case 27:return"ESC";case 38:return"UP";case 40:return"DOWN";case 78:if(e.ctrlKey)return"DOWN";break;case 80:if(e.ctrlKey)return"UP";break}return"OTHER"}}G.Editor=cu;var Y={};Object.defineProperty(Y,"__esModule",{value:!0});Y.Textcomplete=void 0;const au=X,lu=he,Fu=$,hu=["show","shown","render","rendered","selected","hidden","hide"];let Cu=class extends au.EventEmitter{constructor(e,t,D){super(),this.editor=e,this.isQueryInFlight=!1,this.nextPendingQuery=null,this.handleHit=({searchResults:n})=>{n.length?this.dropdown.render(n,this.editor.getCursorOffset()):this.dropdown.hide(),this.isQueryInFlight=!1,this.nextPendingQuery!==null&&this.trigger(this.nextPendingQuery)},this.handleMove=n=>{n.detail.code==="UP"?this.dropdown.up(n):this.dropdown.down(n)},this.handleEnter=n=>{const r=this.dropdown.getActiveItem();r?(this.dropdown.select(r),n.preventDefault()):this.dropdown.hide()},this.handleEsc=n=>{this.dropdown.isShown()&&(this.dropdown.hide(),n.preventDefault())},this.handleChange=n=>{n.detail.beforeCursor!=null?this.trigger(n.detail.beforeCursor):this.dropdown.hide()},this.handleSelect=n=>{this.emit("select",n),n.defaultPrevented||this.editor.applySearchResult(n.detail.searchResult)},this.handleResize=()=>{this.dropdown.isShown()&&this.dropdown.setOffset(this.editor.getCursorOffset())},this.completer=new Fu.Completer(t),this.dropdown=lu.Dropdown.create((D==null?void 0:D.dropdown)||{}),this.startListening()}destroy(e=!0){return this.completer.destroy(),this.dropdown.destroy(),e&&this.editor.destroy(),this.stopListening(),this}isShown(){return this.dropdown.isShown()}hide(){return this.dropdown.hide(),this}trigger(e){return this.isQueryInFlight?this.nextPendingQuery=e:(this.isQueryInFlight=!0,this.nextPendingQuery=null,this.completer.run(e)),this}startListening(){var e;this.editor.on("move",this.handleMove).on("enter",this.handleEnter).on("esc",this.handleEsc).on("change",this.handleChange),this.dropdown.on("select",this.handleSelect);for(const t of hu)this.dropdown.on(t,D=>this.emit(t,D));this.completer.on("hit",this.handleHit),(e=this.dropdown.el.ownerDocument.defaultView)===null||e===void 0||e.addEventListener("resize",this.handleResize)}stopListening(){var e;(e=this.dropdown.el.ownerDocument.defaultView)===null||e===void 0||e.removeEventListener("resize",this.handleResize),this.completer.removeAllListeners(),this.dropdown.removeAllListeners(),this.editor.removeListener("move",this.handleMove).removeListener("enter",this.handleEnter).removeListener("esc",this.handleEsc).removeListener("change",this.handleChange)}};Y.Textcomplete=Cu;(function(u){var e=_&&_.__createBinding||(Object.create?function(D,n,r,s){s===void 0&&(s=r);var i=Object.getOwnPropertyDescriptor(n,r);(!i||("get"in i?!n.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return n[r]}}),Object.defineProperty(D,s,i)}:function(D,n,r,s){s===void 0&&(s=r),D[s]=n[r]}),t=_&&_.__exportStar||function(D,n){for(var r in D)r!=="default"&&!Object.prototype.hasOwnProperty.call(n,r)&&e(n,D,r)};Object.defineProperty(u,"__esModule",{value:!0}),t($,u),t(he,u),t(G,u),t(z,u),t(Fe,u),t(Y,u),t(R,u)})(V);const Le=le(V),Eu=xe({__proto__:null,default:Le},[V]);var Ce={},J={},Oe={},Z={};Object.defineProperty(Z,"__esModule",{value:!0});Z.calculateElementOffset=void 0;const du=u=>{const e=u.getBoundingClientRect(),t=u.ownerDocument;if(t==null)throw new Error("Given element does not belong to document");const{defaultView:D,documentElement:n}=t;if(D==null)throw new Error("Given element does not belong to window");const r={top:e.top+D.pageYOffset,left:e.left+D.pageXOffset};return n&&(r.top-=n.clientTop,r.left-=n.clientLeft),r};Z.calculateElementOffset=du;var q={};Object.defineProperty(q,"__esModule",{value:!0});q.getLineHeightPx=void 0;const fu=48,mu=57,Be=u=>fu<=u&&u<=mu,pu=u=>{const e=getComputedStyle(u),t=e.lineHeight;if(Be(t.charCodeAt(0))){const D=parseFloat(t);return Be(t.charCodeAt(t.length-1))?D*parseFloat(e.fontSize):D}return gu(u.nodeName,e)};q.getLineHeightPx=pu;const gu=(u,e)=>{const t=document.body;if(!t)return 0;const D=document.createElement(u);D.innerHTML="&nbsp;",Object.assign(D.style,{fontSize:e.fontSize,fontFamily:e.fontFamily,padding:"0"}),t.appendChild(D),D instanceof HTMLTextAreaElement&&(D.rows=1);const n=D.offsetHeight;return t.removeChild(D),n};var ee={};Object.defineProperty(ee,"__esModule",{value:!0});ee.isSafari=void 0;const Bu=()=>/^((?!chrome|android).)*safari/i.test(navigator.userAgent);ee.isSafari=Bu;(function(u){var e=_&&_.__createBinding||(Object.create?function(D,n,r,s){s===void 0&&(s=r);var i=Object.getOwnPropertyDescriptor(n,r);(!i||("get"in i?!n.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return n[r]}}),Object.defineProperty(D,s,i)}:function(D,n,r,s){s===void 0&&(s=r),D[s]=n[r]}),t=_&&_.__exportStar||function(D,n){for(var r in D)r!=="default"&&!Object.prototype.hasOwnProperty.call(n,r)&&e(n,D,r)};Object.defineProperty(u,"__esModule",{value:!0}),t(Z,u),t(q,u),t(ee,u)})(Oe);Object.defineProperty(J,"__esModule",{value:!0});J.ContenteditableEditor=void 0;const vu=V,ve=Oe;let Au=class extends vu.Editor{constructor(e){super(),this.el=e,this.onInput=()=>{this.el.normalize(),this.emitChangeEvent()},this.onKeydown=t=>{const D=this.getCode(t);let n;D==="UP"||D==="DOWN"?n=this.emitMoveEvent(D):D==="ENTER"?n=this.emitEnterEvent():D==="ESC"&&(n=this.emitEscEvent()),n&&n.defaultPrevented&&t.preventDefault()},this.startListening=()=>{this.el.addEventListener("input",this.onInput),this.el.addEventListener("keydown",this.onKeydown)},this.stopListening=()=>{this.el.removeEventListener("input",this.onInput),this.el.removeEventListener("keydown",this.onKeydown)},this.startListening()}destroy(){return super.destroy(),this.stopListening(),this}applySearchResult(e){const t=this.getBeforeCursor(),D=this.getAfterCursor();if(t!=null&&D!=null){const n=e.replace(t,D);if(Array.isArray(n)){let r=n[0];(0,ve.isSafari)()&&(r=r.replace(t,""));const s=this.getRange();if(s.selectNode(s.startContainer),this.el.dataset.requiresManualDeletions){for(let o=0;o<t.length;o++)this.el.ownerDocument.execCommand("delete",!1,null);for(let o=0;o<D.length;o++)this.el.ownerDocument.execCommand("forwardDelete",!1,null)}this.el.ownerDocument.execCommand("insertText",!1,r+n[1]),s.detach();const i=this.getRange();i.setStart(i.startContainer,r.length),i.collapse(!0)}}}getCursorOffset(){const e=this.getRange(),t=e.getBoundingClientRect(),D=this.el.ownerDocument.body.getBoundingClientRect(),n=e.startContainer,r=n instanceof Text?n.parentElement:n,s=t.left,i=(0,ve.getLineHeightPx)(r),o=t.top-D.top+i;return this.el.dir!=="rtl"?{left:s,lineHeight:i,top:o}:{right:document.documentElement.clientWidth-s,lineHeight:i,top:o}}getBeforeCursor(){const e=this.getRange();return e.collapsed&&e.startContainer instanceof Text?e.startContainer.wholeText.substring(0,e.startOffset):null}getAfterCursor(){const e=this.getRange();return e.collapsed&&e.startContainer instanceof Text?e.startContainer.wholeText.substring(e.startOffset):null}getRange(e){var t;const D=(t=this.el.ownerDocument.defaultView)===null||t===void 0?void 0:t.getSelection();if(D==null)throw new Error("The element does not belong to view");for(let s=0,i=D.rangeCount;s<i;s++){const o=D.getRangeAt(s);if(this.el.contains(o.startContainer))return o}if(e)throw new Error("Unexpected");const n=this.el.ownerDocument.activeElement;this.el.focus();const r=this.getRange(!0);if(n){const s=n;s.focus&&s.focus()}return r}};J.ContenteditableEditor=Au;(function(u){var e=_&&_.__createBinding||(Object.create?function(D,n,r,s){s===void 0&&(s=r);var i=Object.getOwnPropertyDescriptor(n,r);(!i||("get"in i?!n.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return n[r]}}),Object.defineProperty(D,s,i)}:function(D,n,r,s){s===void 0&&(s=r),D[s]=n[r]}),t=_&&_.__exportStar||function(D,n){for(var r in D)r!=="default"&&!Object.prototype.hasOwnProperty.call(n,r)&&e(n,D,r)};Object.defineProperty(u,"__esModule",{value:!0}),t(J,u)})(Ce);const Ie=le(Ce),_u=xe({__proto__:null,default:Ie},[Ce]);function M(u){return Array.isArray?Array.isArray(u):Re(u)==="[object Array]"}const yu=1/0;function wu(u){if(typeof u=="string")return u;let e=u+"";return e=="0"&&1/u==-yu?"-0":e}function Mu(u){return u==null?"":wu(u)}function w(u){return typeof u=="string"}function Ne(u){return typeof u=="number"}function xu(u){return u===!0||u===!1||bu(u)&&Re(u)=="[object Boolean]"}function Te(u){return typeof u=="object"}function bu(u){return Te(u)&&u!==null}function v(u){return u!=null}function De(u){return!u.trim().length}function Re(u){return u==null?u===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(u)}const Su="Incorrect 'index' type",Lu=u=>`Invalid value for key ${u}`,Ou=u=>`Pattern length exceeds max of ${u}.`,Iu=u=>`Missing ${u} property in key`,Nu=u=>`Property 'weight' in key '${u}' must be a positive integer`,Ae=Object.prototype.hasOwnProperty;class Tu{constructor(e){this._keys=[],this._keyMap={};let t=0;e.forEach(D=>{let n=Pe(D);this._keys.push(n),this._keyMap[n.id]=n,t+=n.weight}),this._keys.forEach(D=>{D.weight/=t})}get(e){return this._keyMap[e]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function Pe(u){let e=null,t=null,D=null,n=1,r=null;if(w(u)||M(u))D=u,e=_e(u),t=ne(u);else{if(!Ae.call(u,"name"))throw new Error(Iu("name"));const s=u.name;if(D=s,Ae.call(u,"weight")&&(n=u.weight,n<=0))throw new Error(Nu(s));e=_e(s),t=ne(s),r=u.getFn}return{path:e,id:t,weight:n,src:D,getFn:r}}function _e(u){return M(u)?u:u.split(".")}function ne(u){return M(u)?u.join("."):u}function Ru(u,e){let t=[],D=!1;const n=(r,s,i)=>{if(v(r))if(!s[i])t.push(r);else{let o=s[i];const c=r[o];if(!v(c))return;if(i===s.length-1&&(w(c)||Ne(c)||xu(c)))t.push(Mu(c));else if(M(c)){D=!0;for(let a=0,l=c.length;a<l;a+=1)n(c[a],s,i+1)}else s.length&&n(c,s,i+1)}};return n(u,w(e)?e.split("."):e,0),D?t:t[0]}const Pu={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},$u={isCaseSensitive:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(u,e)=>u.score===e.score?u.idx<e.idx?-1:1:u.score<e.score?-1:1},zu={location:0,threshold:.6,distance:100},ju={useExtendedSearch:!1,getFn:Ru,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1};var h={...$u,...Pu,...zu,...ju};const Uu=/[^ ]+/g;function Wu(u=1,e=3){const t=new Map,D=Math.pow(10,e);return{get(n){const r=n.match(Uu).length;if(t.has(r))return t.get(r);const s=1/Math.pow(r,.5*u),i=parseFloat(Math.round(s*D)/D);return t.set(r,i),i},clear(){t.clear()}}}class Ee{constructor({getFn:e=h.getFn,fieldNormWeight:t=h.fieldNormWeight}={}){this.norm=Wu(t,3),this.getFn=e,this.isCreated=!1,this.setIndexRecords()}setSources(e=[]){this.docs=e}setIndexRecords(e=[]){this.records=e}setKeys(e=[]){this.keys=e,this._keysMap={},e.forEach((t,D)=>{this._keysMap[t.id]=D})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,w(this.docs[0])?this.docs.forEach((e,t)=>{this._addString(e,t)}):this.docs.forEach((e,t)=>{this._addObject(e,t)}),this.norm.clear())}add(e){const t=this.size();w(e)?this._addString(e,t):this._addObject(e,t)}removeAt(e){this.records.splice(e,1);for(let t=e,D=this.size();t<D;t+=1)this.records[t].i-=1}getValueForItemAtKeyId(e,t){return e[this._keysMap[t]]}size(){return this.records.length}_addString(e,t){if(!v(e)||De(e))return;let D={v:e,i:t,n:this.norm.get(e)};this.records.push(D)}_addObject(e,t){let D={i:t,$:{}};this.keys.forEach((n,r)=>{let s=n.getFn?n.getFn(e):this.getFn(e,n.path);if(v(s)){if(M(s)){let i=[];const o=[{nestedArrIndex:-1,value:s}];for(;o.length;){const{nestedArrIndex:c,value:a}=o.pop();if(v(a))if(w(a)&&!De(a)){let l={v:a,i:c,n:this.norm.get(a)};i.push(l)}else M(a)&&a.forEach((l,F)=>{o.push({nestedArrIndex:F,value:l})})}D.$[r]=i}else if(w(s)&&!De(s)){let i={v:s,n:this.norm.get(s)};D.$[r]=i}}}),this.records.push(D)}toJSON(){return{keys:this.keys,records:this.records}}}function $e(u,e,{getFn:t=h.getFn,fieldNormWeight:D=h.fieldNormWeight}={}){const n=new Ee({getFn:t,fieldNormWeight:D});return n.setKeys(u.map(Pe)),n.setSources(e),n.create(),n}function Hu(u,{getFn:e=h.getFn,fieldNormWeight:t=h.fieldNormWeight}={}){const{keys:D,records:n}=u,r=new Ee({getFn:e,fieldNormWeight:t});return r.setKeys(D),r.setIndexRecords(n),r}function H(u,{errors:e=0,currentLocation:t=0,expectedLocation:D=0,distance:n=h.distance,ignoreLocation:r=h.ignoreLocation}={}){const s=e/u.length;if(r)return s;const i=Math.abs(D-t);return n?s+i/n:i?1:s}function ku(u=[],e=h.minMatchCharLength){let t=[],D=-1,n=-1,r=0;for(let s=u.length;r<s;r+=1){let i=u[r];i&&D===-1?D=r:!i&&D!==-1&&(n=r-1,n-D+1>=e&&t.push([D,n]),D=-1)}return u[r-1]&&r-D>=e&&t.push([D,r-1]),t}const O=32;function Ku(u,e,t,{location:D=h.location,distance:n=h.distance,threshold:r=h.threshold,findAllMatches:s=h.findAllMatches,minMatchCharLength:i=h.minMatchCharLength,includeMatches:o=h.includeMatches,ignoreLocation:c=h.ignoreLocation}={}){if(e.length>O)throw new Error(Ou(O));const a=e.length,l=u.length,F=Math.max(0,Math.min(D,l));let d=r,E=F;const m=i>1||o,C=m?Array(l):[];let g;for(;(g=u.indexOf(e,E))>-1;){let A=H(e,{currentLocation:g,expectedLocation:F,distance:n,ignoreLocation:c});if(d=Math.min(A,d),E=g+a,m){let x=0;for(;x<a;)C[g+x]=1,x+=1}}E=-1;let B=[],f=1,I=a+l;const L=1<<a-1;for(let A=0;A<a;A+=1){let x=0,b=I;for(;x<b;)H(e,{errors:A,currentLocation:F+b,expectedLocation:F,distance:n,ignoreLocation:c})<=d?x=b:I=b,b=Math.floor((I-x)/2+x);I=b;let de=Math.max(1,F-b+1),te=s?l:Math.min(F+b,l)+a,N=Array(te+2);N[te+1]=(1<<A)-1;for(let y=te;y>=de;y-=1){let j=y-1,fe=t[u.charAt(j)];if(m&&(C[j]=+!!fe),N[y]=(N[y+1]<<1|1)&fe,A&&(N[y]|=(B[y+1]|B[y])<<1|1|B[y+1]),N[y]&L&&(f=H(e,{errors:A,currentLocation:j,expectedLocation:F,distance:n,ignoreLocation:c}),f<=d)){if(d=f,E=j,E<=F)break;de=Math.max(1,2*F-E)}}if(H(e,{errors:A+1,currentLocation:F,expectedLocation:F,distance:n,ignoreLocation:c})>d)break;B=N}const ue={isMatch:E>=0,score:Math.max(.001,f)};if(m){const A=ku(C,i);A.length?o&&(ue.indices=A):ue.isMatch=!1}return ue}function Qu(u){let e={};for(let t=0,D=u.length;t<D;t+=1){const n=u.charAt(t);e[n]=(e[n]||0)|1<<D-t-1}return e}class ze{constructor(e,{location:t=h.location,threshold:D=h.threshold,distance:n=h.distance,includeMatches:r=h.includeMatches,findAllMatches:s=h.findAllMatches,minMatchCharLength:i=h.minMatchCharLength,isCaseSensitive:o=h.isCaseSensitive,ignoreLocation:c=h.ignoreLocation}={}){if(this.options={location:t,threshold:D,distance:n,includeMatches:r,findAllMatches:s,minMatchCharLength:i,isCaseSensitive:o,ignoreLocation:c},this.pattern=o?e:e.toLowerCase(),this.chunks=[],!this.pattern.length)return;const a=(F,d)=>{this.chunks.push({pattern:F,alphabet:Qu(F),startIndex:d})},l=this.pattern.length;if(l>O){let F=0;const d=l%O,E=l-d;for(;F<E;)a(this.pattern.substr(F,O),F),F+=O;if(d){const m=l-O;a(this.pattern.substr(m),m)}}else a(this.pattern,0)}searchIn(e){const{isCaseSensitive:t,includeMatches:D}=this.options;if(t||(e=e.toLowerCase()),this.pattern===e){let E={isMatch:!0,score:0};return D&&(E.indices=[[0,e.length-1]]),E}const{location:n,distance:r,threshold:s,findAllMatches:i,minMatchCharLength:o,ignoreLocation:c}=this.options;let a=[],l=0,F=!1;this.chunks.forEach(({pattern:E,alphabet:m,startIndex:C})=>{const{isMatch:g,score:B,indices:f}=Ku(e,E,m,{location:n+C,distance:r,threshold:s,findAllMatches:i,minMatchCharLength:o,includeMatches:D,ignoreLocation:c});g&&(F=!0),l+=B,g&&f&&(a=[...a,...f])});let d={isMatch:F,score:F?l/this.chunks.length:1};return F&&D&&(d.indices=a),d}}class S{constructor(e){this.pattern=e}static isMultiMatch(e){return ye(e,this.multiRegex)}static isSingleMatch(e){return ye(e,this.singleRegex)}search(){}}function ye(u,e){const t=u.match(e);return t?t[1]:null}class Vu extends S{constructor(e){super(e)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(e){const t=e===this.pattern;return{isMatch:t,score:t?0:1,indices:[0,this.pattern.length-1]}}}class Xu extends S{constructor(e){super(e)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(e){const D=e.indexOf(this.pattern)===-1;return{isMatch:D,score:D?0:1,indices:[0,e.length-1]}}}class Gu extends S{constructor(e){super(e)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(e){const t=e.startsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,this.pattern.length-1]}}}class Yu extends S{constructor(e){super(e)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(e){const t=!e.startsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}}class Ju extends S{constructor(e){super(e)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(e){const t=e.endsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[e.length-this.pattern.length,e.length-1]}}}class Zu extends S{constructor(e){super(e)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(e){const t=!e.endsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}}class je extends S{constructor(e,{location:t=h.location,threshold:D=h.threshold,distance:n=h.distance,includeMatches:r=h.includeMatches,findAllMatches:s=h.findAllMatches,minMatchCharLength:i=h.minMatchCharLength,isCaseSensitive:o=h.isCaseSensitive,ignoreLocation:c=h.ignoreLocation}={}){super(e),this._bitapSearch=new ze(e,{location:t,threshold:D,distance:n,includeMatches:r,findAllMatches:s,minMatchCharLength:i,isCaseSensitive:o,ignoreLocation:c})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(e){return this._bitapSearch.searchIn(e)}}class Ue extends S{constructor(e){super(e)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(e){let t=0,D;const n=[],r=this.pattern.length;for(;(D=e.indexOf(this.pattern,t))>-1;)t=D+r,n.push([D,t-1]);const s=!!n.length;return{isMatch:s,score:s?0:1,indices:n}}}const se=[Vu,Ue,Gu,Yu,Zu,Ju,Xu,je],we=se.length,qu=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,et="|";function ut(u,e={}){return u.split(et).map(t=>{let D=t.trim().split(qu).filter(r=>r&&!!r.trim()),n=[];for(let r=0,s=D.length;r<s;r+=1){const i=D[r];let o=!1,c=-1;for(;!o&&++c<we;){const a=se[c];let l=a.isMultiMatch(i);l&&(n.push(new a(l,e)),o=!0)}if(!o)for(c=-1;++c<we;){const a=se[c];let l=a.isSingleMatch(i);if(l){n.push(new a(l,e));break}}}return n})}const tt=new Set([je.type,Ue.type]);class Dt{constructor(e,{isCaseSensitive:t=h.isCaseSensitive,includeMatches:D=h.includeMatches,minMatchCharLength:n=h.minMatchCharLength,ignoreLocation:r=h.ignoreLocation,findAllMatches:s=h.findAllMatches,location:i=h.location,threshold:o=h.threshold,distance:c=h.distance}={}){this.query=null,this.options={isCaseSensitive:t,includeMatches:D,minMatchCharLength:n,findAllMatches:s,ignoreLocation:r,location:i,threshold:o,distance:c},this.pattern=t?e:e.toLowerCase(),this.query=ut(this.pattern,this.options)}static condition(e,t){return t.useExtendedSearch}searchIn(e){const t=this.query;if(!t)return{isMatch:!1,score:1};const{includeMatches:D,isCaseSensitive:n}=this.options;e=n?e:e.toLowerCase();let r=0,s=[],i=0;for(let o=0,c=t.length;o<c;o+=1){const a=t[o];s.length=0,r=0;for(let l=0,F=a.length;l<F;l+=1){const d=a[l],{isMatch:E,indices:m,score:C}=d.search(e);if(E){if(r+=1,i+=C,D){const g=d.constructor.type;tt.has(g)?s=[...s,...m]:s.push(m)}}else{i=0,r=0,s.length=0;break}}if(r){let l={isMatch:!0,score:i/r};return D&&(l.indices=s),l}}return{isMatch:!1,score:1}}}const re=[];function nt(...u){re.push(...u)}function ie(u,e){for(let t=0,D=re.length;t<D;t+=1){let n=re[t];if(n.condition(u,e))return new n(u,e)}return new ze(u,e)}const Q={AND:"$and",OR:"$or"},oe={PATH:"$path",PATTERN:"$val"},ce=u=>!!(u[Q.AND]||u[Q.OR]),st=u=>!!u[oe.PATH],rt=u=>!M(u)&&Te(u)&&!ce(u),Me=u=>({[Q.AND]:Object.keys(u).map(e=>({[e]:u[e]}))});function We(u,e,{auto:t=!0}={}){const D=n=>{let r=Object.keys(n);const s=st(n);if(!s&&r.length>1&&!ce(n))return D(Me(n));if(rt(n)){const o=s?n[oe.PATH]:r[0],c=s?n[oe.PATTERN]:n[o];if(!w(c))throw new Error(Lu(o));const a={keyId:ne(o),pattern:c};return t&&(a.searcher=ie(c,e)),a}let i={children:[],operator:r[0]};return r.forEach(o=>{const c=n[o];M(c)&&c.forEach(a=>{i.children.push(D(a))})}),i};return ce(u)||(u=Me(u)),D(u)}function it(u,{ignoreFieldNorm:e=h.ignoreFieldNorm}){u.forEach(t=>{let D=1;t.matches.forEach(({key:n,norm:r,score:s})=>{const i=n?n.weight:null;D*=Math.pow(s===0&&i?Number.EPSILON:s,(i||1)*(e?1:r))}),t.score=D})}function ot(u,e){const t=u.matches;e.matches=[],v(t)&&t.forEach(D=>{if(!v(D.indices)||!D.indices.length)return;const{indices:n,value:r}=D;let s={indices:n,value:r};D.key&&(s.key=D.key.src),D.idx>-1&&(s.refIndex=D.idx),e.matches.push(s)})}function ct(u,e){e.score=u.score}function at(u,e,{includeMatches:t=h.includeMatches,includeScore:D=h.includeScore}={}){const n=[];return t&&n.push(ot),D&&n.push(ct),u.map(r=>{const{idx:s}=r,i={item:e[s],refIndex:s};return n.length&&n.forEach(o=>{o(r,i)}),i})}class P{constructor(e,t={},D){this.options={...h,...t},this.options.useExtendedSearch,this._keyStore=new Tu(this.options.keys),this.setCollection(e,D)}setCollection(e,t){if(this._docs=e,t&&!(t instanceof Ee))throw new Error(Su);this._myIndex=t||$e(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(e){v(e)&&(this._docs.push(e),this._myIndex.add(e))}remove(e=()=>!1){const t=[];for(let D=0,n=this._docs.length;D<n;D+=1){const r=this._docs[D];e(r,D)&&(this.removeAt(D),D-=1,n-=1,t.push(r))}return t}removeAt(e){this._docs.splice(e,1),this._myIndex.removeAt(e)}getIndex(){return this._myIndex}search(e,{limit:t=-1}={}){const{includeMatches:D,includeScore:n,shouldSort:r,sortFn:s,ignoreFieldNorm:i}=this.options;let o=w(e)?w(this._docs[0])?this._searchStringList(e):this._searchObjectList(e):this._searchLogical(e);return it(o,{ignoreFieldNorm:i}),r&&o.sort(s),Ne(t)&&t>-1&&(o=o.slice(0,t)),at(o,this._docs,{includeMatches:D,includeScore:n})}_searchStringList(e){const t=ie(e,this.options),{records:D}=this._myIndex,n=[];return D.forEach(({v:r,i:s,n:i})=>{if(!v(r))return;const{isMatch:o,score:c,indices:a}=t.searchIn(r);o&&n.push({item:r,idx:s,matches:[{score:c,value:r,norm:i,indices:a}]})}),n}_searchLogical(e){const t=We(e,this.options),D=(i,o,c)=>{if(!i.children){const{keyId:l,searcher:F}=i,d=this._findMatches({key:this._keyStore.get(l),value:this._myIndex.getValueForItemAtKeyId(o,l),searcher:F});return d&&d.length?[{idx:c,item:o,matches:d}]:[]}const a=[];for(let l=0,F=i.children.length;l<F;l+=1){const d=i.children[l],E=D(d,o,c);if(E.length)a.push(...E);else if(i.operator===Q.AND)return[]}return a},n=this._myIndex.records,r={},s=[];return n.forEach(({$:i,i:o})=>{if(v(i)){let c=D(t,i,o);c.length&&(r[o]||(r[o]={idx:o,item:i,matches:[]},s.push(r[o])),c.forEach(({matches:a})=>{r[o].matches.push(...a)}))}}),s}_searchObjectList(e){const t=ie(e,this.options),{keys:D,records:n}=this._myIndex,r=[];return n.forEach(({$:s,i})=>{if(!v(s))return;let o=[];D.forEach((c,a)=>{o.push(...this._findMatches({key:c,value:s[a],searcher:t}))}),o.length&&r.push({idx:i,item:s,matches:o})}),r}_findMatches({key:e,value:t,searcher:D}){if(!v(t))return[];let n=[];if(M(t))t.forEach(({v:r,i:s,n:i})=>{if(!v(r))return;const{isMatch:o,score:c,indices:a}=D.searchIn(r);o&&n.push({score:c,key:e,value:r,idx:s,norm:i,indices:a})});else{const{v:r,n:s}=t,{isMatch:i,score:o,indices:c}=D.searchIn(r);i&&n.push({score:o,key:e,value:r,norm:s,indices:c})}return n}}P.version="7.0.0";P.createIndex=$e;P.parseIndex=Hu;P.config=h;P.parseQuery=We;nt(Dt);const{Textcomplete:lt}=Le||Eu,{ContenteditableEditor:Ft}=Ie||_u;let He,ae,ke;const ht=u=>{let e=u.split(":").join("");if(p.get("useEmoteFuzzyMatching"))return He.search(e);e=e.toLowerCase();const t=[];for(const D of ae)D.name.toLowerCase().includes(e)&&t.push({item:D});return t},Ct={id:"emote",match:/\B:([-+\w]*)$/,index:1,search:async(u,e,t)=>{e(ht(u))},cache:!1,template:u=>`<img src="${u.item.url}?accessKey=${p.get("accessKey")}">&nbsp;<small>${u.item.name}</small>`,replace:u=>`:${u.item.name}: `},Et=async(u,e=!1)=>{if(u.dataset.handlingEmoteSuggestions)return;u.dataset.handlingEmoteSuggestions=!0,e&&(u.dataset.requiresManualDeletions=!0);const t=new lt(new Ft(u),[Ct],ke);new window.MutationObserver((D,n)=>{document.body.contains(u)||(t.destroy(),n.disconnect())}).observe(document.body,{childList:!0,subtree:!0})},Ke=u=>{if(u.nodeType!==window.Node.ELEMENT_NODE)return;const e=[{class:"mx_BasicMessageComposer_input",requiresManualDeletions:!1},{class:"mx_WysiwygComposer_Editor_content",requiresManualDeletions:!0}];if(u.classList){for(const t of e)if(u.classList.contains(t.class)){Et(u,t.requiresManualDeletions);return}}u.childNodes&&[...u.childNodes].forEach(Ke)},dt={initialize:()=>{const u=p.get("emoteSuggestionBlacklistedStrings").split("|").map(e=>e.trim().toLowerCase()).filter(e=>e!=="");ae=p.get("emotes").filter(e=>{const t=e.name.toLowerCase();for(const D of u)if(t.includes(D))return!1;return!0}),p.get("useEmoteFuzzyMatching")&&(He=new P(ae,{keys:["name"],location:p.get("emoteFuzzyMatchingLocation"),distance:p.get("emoteFuzzyMatchingDistance"),threshold:p.get("emoteFuzzyMatchingThreshold")})),ke={dropdown:{className:"dropdown-menu textcomplete-dropdown mx_Autocomplete",maxCount:p.get("emoteSuggestionAmount"),placement:"top",header:()=>"",footer:()=>"",rotate:!0,style:{display:"none",position:"absolute",zIndex:"1000"},parent:document.body,item:{className:"textcomplete-item mx_Autocomplete_Completion_pill",activeClassName:"textcomplete-item active mx_Autocomplete_Completion_pill mx_Autocomplete_Completion selected"}}},new window.MutationObserver(e=>{for(const t of e)for(const D of t.addedNodes)Ke(D)}).observe(document.body,{childList:!0,subtree:!0})}};/*!
 * element-emotes
 * Copyright (C) 2022-present  Michael Serajnik  https://github.com/mserajnik
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */const ft=["var(--cpd-color-blue-1200)","var(--cpd-color-fuchsia-1200)","var(--cpd-color-green-1200)","var(--cpd-color-pink-1200)","var(--cpd-color-orange-1200)","var(--cpd-color-cyan-1200)","var(--cpd-color-purple-1200)","var(--cpd-color-lime-1200)"],k=[],mt={initialize:()=>{const u=p.get("usernameColors");for(let D=0;D<8;D++){if(u[D]!==""&&u[D]!==ft[D]){k.push(u[D]);continue}k.push(null)}if(!k.some(D=>D!==null))return;const t=document.createElement("style");for(const[D,n]of k.entries())n&&(t.innerHTML+=`
        .mx_Username_color${D+1} {
          color: ${n} !important;
        }
      `);document.head.appendChild(t)}};/*!
 * element-emotes
 * Copyright (C) 2022-present  Michael Serajnik  https://github.com/mserajnik
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */(async()=>{try{await p.initialize()}catch(u){window.alert(u);return}qe.initialize(),dt.initialize(),mt.initialize()})();
