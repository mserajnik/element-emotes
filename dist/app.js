function we(u,e){for(var t=0;t<e.length;t++){const n=e[t];if(typeof n!="string"&&!Array.isArray(n)){for(const D in n)if(D!=="default"&&!(D in u)){const r=Object.getOwnPropertyDescriptor(n,D);r&&Object.defineProperty(u,D,r.get?r:{enumerable:!0,get:()=>n[D]})}}}return Object.freeze(Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}))}/*!
 * element-emotes
 * Copyright (C) 2022-present  Michael Serajnik  https://github.com/mserajnik
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */const Ke=(u,e)=>`${u}?accessKey=${e}`,ke={fetchEmotes:async()=>{let u=await fetch(Ke(g.get("emotesUrl"),g.get("accessKey")));if(!u.ok){const e=new Error(`HTTP status code: ${u.status}`);throw e.response=u,e.status=u.status,e}return u=await u.json(),u.emotes}};/*!
 * element-emotes
 * Copyright (C) 2022-present  Michael Serajnik  https://github.com/mserajnik
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */let de=!1;const W={emotesUrl:null,accessKey:null,defaultEmoteSize:null,largeEmoteSize:null,useFrozenEmotes:null,emoteSuggestionAmount:null,useEmoteFuzzyMatching:null,emoteFuzzyMatchingLocation:null,emoteFuzzyMatchingDistance:null,emoteFuzzyMatchingThreshold:null,emotes:[]},g={initialize:()=>new Promise((u,e)=>{chrome.storage.sync.get(null,async t=>{if(chrome.runtime.lastError)return e(new Error("Error while intializing the store."));for(const n in t)Object.hasOwn(W,n)&&(W[n]=t[n]);de=!0;try{W.emotes=await ke.fetchEmotes()}catch{return e(new Error("Error while trying to fetch the emote list; is the emote server URL and/or access key set correctly?"))}u()})}),get:u=>{if(!de)throw new Error("Store has not been initialized; call `store.initialize()` first.");return W[u]}};var _=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ce(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var Qe=/\uD83E\uDDD1(?:\uD83C\uDFFF\u200D\u2764\uFE0F\u200D\uD83D\uDC8B\u200D\uD83E\uDDD1(?:\uD83C[\uDFFB-\uDFFE])|\uD83C\uDFFE\u200D\u2764\uFE0F\u200D\uD83D\uDC8B\u200D\uD83E\uDDD1(?:\uD83C[\uDFFB-\uDFFD\uDFFF])|\uD83C\uDFFD\u200D\u2764\uFE0F\u200D\uD83D\uDC8B\u200D\uD83E\uDDD1(?:\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])|\uD83C\uDFFC\u200D\u2764\uFE0F\u200D\uD83D\uDC8B\u200D\uD83E\uDDD1(?:\uD83C[\uDFFB\uDFFD-\uDFFF])|\uD83C\uDFFB\u200D\u2764\uFE0F\u200D\uD83D\uDC8B\u200D\uD83E\uDDD1(?:\uD83C[\uDFFC-\uDFFF]))|\uD83D\uDC68(?:\uD83C[\uDFFB-\uDFFF])\u200D\u2764\uFE0F\u200D\uD83D\uDC8B\u200D\uD83D\uDC68(?:\uD83C[\uDFFB-\uDFFF])|\uD83D\uDC69(?:\uD83C[\uDFFB-\uDFFF])\u200D\u2764\uFE0F\u200D\uD83D\uDC8B\u200D(?:\uD83D[\uDC68\uDC69])(?:\uD83C[\uDFFB-\uDFFF])|\uD83E\uDDD1(?:\uD83C\uDFFF\u200D\u2764\u200D\uD83D\uDC8B\u200D\uD83E\uDDD1(?:\uD83C[\uDFFB-\uDFFE])|\uD83C\uDFFE\u200D\u2764\u200D\uD83D\uDC8B\u200D\uD83E\uDDD1(?:\uD83C[\uDFFB-\uDFFD\uDFFF])|\uD83C\uDFFD\u200D\u2764\u200D\uD83D\uDC8B\u200D\uD83E\uDDD1(?:\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])|\uD83C\uDFFC\u200D\u2764\u200D\uD83D\uDC8B\u200D\uD83E\uDDD1(?:\uD83C[\uDFFB\uDFFD-\uDFFF])|\uD83C\uDFFB\u200D\u2764\u200D\uD83D\uDC8B\u200D\uD83E\uDDD1(?:\uD83C[\uDFFC-\uDFFF]))|\uD83D\uDC68(?:\uD83C[\uDFFB-\uDFFF])\u200D\u2764\u200D\uD83D\uDC8B\u200D\uD83D\uDC68(?:\uD83C[\uDFFB-\uDFFF])|\uD83D\uDC69(?:\uD83C[\uDFFB-\uDFFF])\u200D\u2764\u200D\uD83D\uDC8B\u200D(?:\uD83D[\uDC68\uDC69])(?:\uD83C[\uDFFB-\uDFFF])|\uD83D\uDC68(?:\u200D\u2764\uFE0F\u200D\uD83D\uDC8B\u200D\uD83D\uDC68|(?:\uD83C[\uDFFB-\uDFFF])\u200D\u2764\uFE0F\u200D\uD83D\uDC68(?:\uD83C[\uDFFB-\uDFFF]))|\uD83E\uDDD1(?:\uD83C\uDFFF\u200D\u2764\uFE0F\u200D\uD83E\uDDD1(?:\uD83C[\uDFFB-\uDFFE])|\uD83C\uDFFE\u200D\u2764\uFE0F\u200D\uD83E\uDDD1(?:\uD83C[\uDFFB-\uDFFD\uDFFF])|\uD83C\uDFFD\u200D\u2764\uFE0F\u200D\uD83E\uDDD1(?:\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])|\uD83C\uDFFC\u200D\u2764\uFE0F\u200D\uD83E\uDDD1(?:\uD83C[\uDFFB\uDFFD-\uDFFF])|\uD83C\uDFFB\u200D\u2764\uFE0F\u200D\uD83E\uDDD1(?:\uD83C[\uDFFC-\uDFFF]))|\uD83D\uDC69\u200D\u2764\uFE0F\u200D\uD83D\uDC8B\u200D(?:\uD83D[\uDC68\uDC69])|\uD83D\uDC69(?:\uD83C[\uDFFB-\uDFFF])\u200D\u2764\uFE0F\u200D(?:\uD83D[\uDC68\uDC69])(?:\uD83C[\uDFFB-\uDFFF])|(?:\uD83C\uDFC3|\uD83D\uDEB6|\uD83E\uDDCE)(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2640\u2642]\uFE0F\u200D\u27A1\uFE0F|\uD83C\uDFF4\uDB40\uDC67\uDB40\uDC62(?:\uDB40\uDC77\uDB40\uDC6C\uDB40\uDC73|\uDB40\uDC73\uDB40\uDC63\uDB40\uDC74|\uDB40\uDC65\uDB40\uDC6E\uDB40\uDC67)\uDB40\uDC7F|\uD83E\uDDD1\u200D\uD83E\uDDD1\u200D\uD83E\uDDD2\u200D\uD83E\uDDD2|(?:\uD83D\uDC68\uD83C\uDFFF\u200D\uD83E\uDD1D\u200D\uD83D\uDC68|\uD83E\uDDD1\uD83C\uDFFF\u200D\u2764\u200D\uD83E\uDDD1)(?:\uD83C[\uDFFB-\uDFFE])|(?:\uD83D\uDC68\uD83C\uDFFE\u200D\uD83E\uDD1D\u200D\uD83D\uDC68|\uD83E\uDDD1\uD83C\uDFFE\u200D\u2764\u200D\uD83E\uDDD1)(?:\uD83C[\uDFFB-\uDFFD\uDFFF])|(?:\uD83D\uDC68\uD83C\uDFFD\u200D\uD83E\uDD1D\u200D\uD83D\uDC68|\uD83E\uDDD1\uD83C\uDFFD\u200D\u2764\u200D\uD83E\uDDD1)(?:\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])|(?:\uD83D\uDC68\uD83C\uDFFC\u200D\uD83E\uDD1D\u200D\uD83D\uDC68|\uD83E\uDDD1\uD83C\uDFFC\u200D\u2764\u200D\uD83E\uDDD1)(?:\uD83C[\uDFFB\uDFFD-\uDFFF])|(?:\uD83D\uDC68\uD83C\uDFFB\u200D\uD83E\uDD1D\u200D\uD83D\uDC68|\uD83E\uDDD1\uD83C\uDFFB\u200D\u2764\u200D\uD83E\uDDD1)(?:\uD83C[\uDFFC-\uDFFF])|\uD83D\uDC69(?:\u200D(?:\uD83D\uDC69\u200D(?:\uD83D\uDC66\u200D\uD83D\uDC66|\uD83D\uDC67\u200D(?:\uD83D[\uDC66\uDC67]))|\u2764\u200D\uD83D\uDC8B\u200D(?:\uD83D[\uDC68\uDC69]))|\uD83C\uDFFF\u200D\uD83E\uDD1D\u200D(?:\uD83D[\uDC68\uDC69])(?:\uD83C[\uDFFB-\uDFFE])|\uD83C\uDFFE\u200D\uD83E\uDD1D\u200D(?:\uD83D[\uDC68\uDC69])(?:\uD83C[\uDFFB-\uDFFD\uDFFF])|\uD83C\uDFFD\u200D\uD83E\uDD1D\u200D(?:\uD83D[\uDC68\uDC69])(?:\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])|\uD83C\uDFFC\u200D\uD83E\uDD1D\u200D(?:\uD83D[\uDC68\uDC69])(?:\uD83C[\uDFFB\uDFFD-\uDFFF])|\uD83C\uDFFB\u200D(?:\uD83E\uDD1D\u200D(?:\uD83D[\uDC68\uDC69])(?:\uD83C[\uDFFC-\uDFFF])|(?:\uD83E[\uDDAF\uDDBC\uDDBD])\u200D\u27A1\uFE0F|\u2764\u200D(?:\uD83D[\uDC68\uDC69])(?:\uD83C[\uDFFB-\uDFFF]))|(?:\uD83C\uDFFF\u200D(?:\uD83E[\uDDAF\uDDBC\uDDBD])|\uD83C\uDFFE\u200D(?:\uD83E[\uDDAF\uDDBC\uDDBD])|\uD83C\uDFFD\u200D(?:\uD83E[\uDDAF\uDDBC\uDDBD])|\uD83C\uDFFC\u200D(?:\uD83E[\uDDAF\uDDBC\uDDBD]))\u200D\u27A1\uFE0F|(?:\uD83C[\uDFFC-\uDFFF])\u200D\u2764\u200D(?:\uD83D[\uDC68\uDC69])(?:\uD83C[\uDFFB-\uDFFF]))|\uD83D\uDC68\u200D\u2764\u200D\uD83D\uDC8B\u200D\uD83D\uDC68|\uD83D\uDC68\u200D(?:\uD83D[\uDC68\uDC69])\u200D(?:\uD83D\uDC66\u200D\uD83D\uDC66|\uD83D\uDC67\u200D(?:\uD83D[\uDC66\uDC67]))|(?:\uD83E\uDDD1(?:\uD83C[\uDFFB-\uDFFF])\u200D\uD83E\uDD1D\u200D\uD83E\uDDD1|\uD83D\uDC68(?:\uD83C[\uDFFB-\uDFFF])\u200D\u2764\u200D\uD83D\uDC68)(?:\uD83C[\uDFFB-\uDFFF])|(?:\uD83E\uDDD1(?:\uD83C\uDFFF\u200D(?:\uD83E[\uDDAF\uDDBC\uDDBD])|\uD83C\uDFFE\u200D(?:\uD83E[\uDDAF\uDDBC\uDDBD])|\uD83C\uDFFD\u200D(?:\uD83E[\uDDAF\uDDBC\uDDBD])|\uD83C\uDFFC\u200D(?:\uD83E[\uDDAF\uDDBC\uDDBD])|\uD83C\uDFFB\u200D(?:\uD83E[\uDDAF\uDDBC\uDDBD]))|\uD83D\uDC68(?:\uD83C\uDFFF\u200D(?:\uD83E[\uDDAF\uDDBC\uDDBD])|\uD83C\uDFFE\u200D(?:\uD83E[\uDDAF\uDDBC\uDDBD])|\uD83C\uDFFD\u200D(?:\uD83E[\uDDAF\uDDBC\uDDBD])|\uD83C\uDFFC\u200D(?:\uD83E[\uDDAF\uDDBC\uDDBD])|\uD83C\uDFFB\u200D(?:\uD83E[\uDDAF\uDDBC\uDDBD]))|(?:\uD83C\uDFC3|\uD83D\uDEB6|\uD83E\uDDCE)\u200D[\u2640\u2642]\uFE0F)\u200D\u27A1\uFE0F|(?:\uD83C\uDFC3|\uD83D\uDEB6|\uD83E\uDDCE)(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2640\u2642]\uFE0F\u200D\u27A1|(?:\uD83C\uDFC3|\uD83D\uDEB6|\uD83E\uDDCE)(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2640\u2642]\u200D\u27A1\uFE0F|\uD83D\uDC68(?:\u200D(?:\u2764\uFE0F\u200D\uD83D\uDC68|(?:\uD83E[\uDDAF\uDDBC\uDDBD])\u200D\u27A1\uFE0F)|(?:\uD83C[\uDFFB-\uDFFF])\u200D(?:\uD83E[\uDDAF\uDDBC\uDDBD])\u200D\u27A1)|\uD83D\uDC69\u200D\u2764\uFE0F\u200D(?:\uD83D[\uDC68\uDC69])|(?:\uD83E\uDDD1(?:\uD83C[\uDFFB-\uDFFF])|\uD83D\uDC69(?:\uD83C[\uDFFB-\uDFFF]))\u200D(?:\uD83E[\uDDAF\uDDBC\uDDBD])\u200D\u27A1|(?:\uD83E\uDDD1\u200D(?:\uD83E[\uDDAF\uDDBC\uDDBD])|\uD83D\uDC69\u200D(?:\uD83E[\uDDAF\uDDBC\uDDBD]))\u200D\u27A1\uFE0F|(?:\uD83C\uDFC3|\uD83D\uDEB6|\uD83E\uDDCE)(?:(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2640\u2642]|\u200D[\u2640\u2642]\uFE0F)\u200D\u27A1|(?:\uD83C\uDFC3|\uD83D\uDEB6|\uD83E\uDDCE)\u200D[\u2640\u2642]\u200D\u27A1\uFE0F|\uD83E\uDDD1\u200D(?:\uD83E\uDD1D\u200D\uD83E\uDDD1|(?:\uD83E[\uDDD1\uDDD2])\u200D\uD83E\uDDD2)|\uD83D\uDC69\u200D\uD83D\uDC66\u200D\uD83D\uDC66|\uD83D\uDC68(?:\u200D(?:\uD83D\uDC66\u200D\uD83D\uDC66|\u2764\u200D\uD83D\uDC68|(?:\uD83E[\uDDAF\uDDBC\uDDBD])\u200D\u27A1|(?:\uD83D[\uDC67-\uDC69])\u200D(?:\uD83D[\uDC66\uDC67]))|(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2695\u2696\u2708]\uFE0F)|\uD83E\uDEF1(?:\uD83C\uDFFF\u200D\uD83E\uDEF2(?:\uD83C[\uDFFB-\uDFFE])|\uD83C\uDFFE\u200D\uD83E\uDEF2(?:\uD83C[\uDFFB-\uDFFD\uDFFF])|\uD83C\uDFFD\u200D\uD83E\uDEF2(?:\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])|\uD83C\uDFFC\u200D\uD83E\uDEF2(?:\uD83C[\uDFFB\uDFFD-\uDFFF])|\uD83C\uDFFB\u200D\uD83E\uDEF2(?:\uD83C[\uDFFC-\uDFFF]))|(?:\uD83D\uDC41\uFE0F\u200D\uD83D\uDDE8|\uD83C\uDFF3\uFE0F\u200D\u26A7|(?:\uD83C[\uDFC4\uDFCA]|\uD83D[\uDC6E\uDC70\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4\uDEB5]|\uD83E[\uDD26\uDD35\uDD37-\uDD39\uDD3D\uDD3E\uDDB8\uDDB9\uDDCD\uDDCF\uDDD4\uDDD6-\uDDDD])(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2640\u2642]|(?:\u26F9|\uD83C[\uDFCB\uDFCC]|\uD83D\uDD75)(?:\uFE0F|\uD83C[\uDFFB-\uDFFF])\u200D[\u2640\u2642]|(?:\uD83C\uDFC3|\uD83D\uDEB6|\uD83E\uDDCE)(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2640\u2642\u27A1])\uFE0F|\uD83D\uDC69\u200D\u2764\u200D(?:\uD83D[\uDC68\uDC69])|(?:\uD83E\uDDD1(?:\uD83C[\uDFFB-\uDFFF])|\uD83D\uDC69(?:\uD83C[\uDFFB-\uDFFF]))\u200D[\u2695\u2696\u2708]\uFE0F|(?:\uD83E\uDDD1\u200D(?:\uD83E[\uDDAF\uDDBC\uDDBD])|\uD83D\uDC69\u200D(?:\uD83E[\uDDAF\uDDBC\uDDBD])|(?:\uD83C\uDFC3|\uD83D\uDEB6|\uD83E\uDDCE)\u200D[\u2640\u2642])\u200D\u27A1|\uD83D\uDC69\u200D(?:\uD83D[\uDC67\uDC69])\u200D(?:\uD83D[\uDC66\uDC67])|\uD83D\uDC41\uFE0F\u200D\uD83D\uDDE8|(?:\uD83D\uDE36\u200D\uD83C\uDF2B|\uD83D\uDC41\u200D\uD83D\uDDE8|\uD83D\uDE42\u200D[\u2194\u2195]|\uD83D\uDC3B\u200D\u2744|\uD83C\uDFF4\u200D\u2620|\uD83C\uDFF3\u200D\u26A7|\uD83E\uDDD1\u200D[\u2695\u2696\u2708]|(?:\uD83C[\uDFC4\uDFCA]|\uD83D[\uDC6E-\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4\uDEB5]|\uD83E[\uDD26\uDD35\uDD37-\uDD39\uDD3C-\uDD3E\uDDB8\uDDB9\uDDCD\uDDCF\uDDD4\uDDD6-\uDDDF])\u200D[\u2640\u2642]|(?:\u26F9|\uD83C[\uDFCB\uDFCC]|\uD83D\uDD75)\u200D[\u2640\u2642]|(?:\uD83D[\uDC68\uDC69])\u200D[\u2695\u2696\u2708])\uFE0F|\uD83C\uDFF3\uFE0F\u200D(?:\u26A7|\uD83C\uDF08)|\u26D3\uFE0F\u200D\uD83D\uDCA5|\uD83E\uDDD1(?:\uD83C[\uDFFB-\uDFFF])\u200D(?:[\u2695\u2696\u2708]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\u2764\uFE0F\u200D(?:\uD83D\uDD25|\uD83E\uDE79)|(?:\uD83C[\uDFC4\uDFCA]|\uD83D[\uDC6E\uDC70\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4\uDEB5]|\uD83E[\uDD26\uDD35\uDD37-\uDD39\uDD3D\uDD3E\uDDB8\uDDB9\uDDCD\uDDCF\uDDD4\uDDD6-\uDDDD])(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2640\u2642]|(?:\u26F9|\uD83C[\uDFCB\uDFCC]|\uD83D\uDD75)(?:\uFE0F|\uD83C[\uDFFB-\uDFFF])\u200D[\u2640\u2642]|(?:\uD83D[\uDC68\uDC69])(?:\uD83C[\uDFFB-\uDFFF])\u200D(?:[\u2695\u2696\u2708]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|(?:\uD83C\uDFC3|\uD83D\uDEB6|\uD83E\uDDCE)(?:(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2640\u2642\u27A1]|\u200D[\u2640\u2642\u27A1]\uFE0F)|\uD83D\uDE36\u200D\uD83C\uDF2B|\uD83D\uDE35\u200D\uD83D\uDCAB|\uD83D\uDE2E\u200D\uD83D\uDCA8|\uD83D\uDC41\u200D\uD83D\uDDE8|\uD83D\uDC15\u200D\uD83E\uDDBA|\uD83C\uDF4B\u200D\uD83D\uDFE9|\uD83C\uDF44\u200D\uD83D\uDFEB|\uD83D\uDE42\u200D[\u2194\u2195]|\uD83D\uDC3B\u200D\u2744|\uD83D\uDC26\u200D(?:\u2B1B|\uD83D\uDD25)|\uD83D\uDC08\u200D\u2B1B|\uD83C\uDFF4\u200D\u2620|\uD83C\uDFF3\u200D(?:\u26A7|\uD83C\uDF08)|\u26D3\u200D\uD83D\uDCA5|\uD83E\uDDD1\u200D(?:[\u2695\u2696\u2708]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD\uDDD2])|\u2764\u200D(?:\uD83D\uDD25|\uD83E\uDE79)|(?:\u26F9|\uD83C[\uDFC4\uDFCA-\uDFCC]|\uD83D[\uDC6E-\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDD75\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4\uDEB5]|\uD83E[\uDD26\uDD35\uDD37-\uDD39\uDD3C-\uDD3E\uDDB8\uDDB9\uDDCD\uDDCF\uDDD4\uDDD6-\uDDDF])\u200D[\u2640\u2642]|(?:\uD83C\uDFC3|\uD83D\uDEB6|\uD83E\uDDCE)\u200D[\u2640\u2642\u27A1]|(?:\uD83D[\uDC68\uDC69])\u200D(?:[\u2695\u2696\u2708]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDC66\uDC67\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|[#\*0-9]\uFE0F\u20E3|\uD83C\uDDFD\uD83C\uDDF0|\uD83C\uDDF6\uD83C\uDDE6|\uD83C\uDDF4\uD83C\uDDF2|\uD83C\uDDFF(?:\uD83C[\uDDE6\uDDF2\uDDFC])|\uD83C\uDDFE(?:\uD83C[\uDDEA\uDDF9])|\uD83C\uDDFC(?:\uD83C[\uDDEB\uDDF8])|\uD83C\uDDFB(?:\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDEE\uDDF3\uDDFA])|\uD83C\uDDFA(?:\uD83C[\uDDE6\uDDEC\uDDF2\uDDF3\uDDF8\uDDFE\uDDFF])|\uD83C\uDDF9(?:\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDED\uDDEF-\uDDF4\uDDF7\uDDF9\uDDFB\uDDFC\uDDFF])|\uD83C\uDDF8(?:\uD83C[\uDDE6-\uDDEA\uDDEC-\uDDF4\uDDF7-\uDDF9\uDDFB\uDDFD-\uDDFF])|\uD83C\uDDF7(?:\uD83C[\uDDEA\uDDF4\uDDF8\uDDFA\uDDFC])|\uD83C\uDDF5(?:\uD83C[\uDDE6\uDDEA-\uDDED\uDDF0-\uDDF3\uDDF7-\uDDF9\uDDFC\uDDFE])|\uD83C\uDDF3(?:\uD83C[\uDDE6\uDDE8\uDDEA-\uDDEC\uDDEE\uDDF1\uDDF4\uDDF5\uDDF7\uDDFA\uDDFF])|\uD83C\uDDF2(?:\uD83C[\uDDE6\uDDE8-\uDDED\uDDF0-\uDDFF])|\uD83C\uDDF1(?:\uD83C[\uDDE6-\uDDE8\uDDEE\uDDF0\uDDF7-\uDDFB\uDDFE])|\uD83C\uDDF0(?:\uD83C[\uDDEA\uDDEC-\uDDEE\uDDF2\uDDF3\uDDF5\uDDF7\uDDFC\uDDFE\uDDFF])|\uD83C\uDDEF(?:\uD83C[\uDDEA\uDDF2\uDDF4\uDDF5])|\uD83C\uDDEE(?:\uD83C[\uDDE8-\uDDEA\uDDF1-\uDDF4\uDDF6-\uDDF9])|\uD83C\uDDED(?:\uD83C[\uDDF0\uDDF2\uDDF3\uDDF7\uDDF9\uDDFA])|\uD83C\uDDEC(?:\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEE\uDDF1-\uDDF3\uDDF5-\uDDFA\uDDFC\uDDFE])|\uD83C\uDDEB(?:\uD83C[\uDDEE-\uDDF0\uDDF2\uDDF4\uDDF7])|\uD83C\uDDEA(?:\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDED\uDDF7-\uDDFA])|\uD83C\uDDE9(?:\uD83C[\uDDEA\uDDEC\uDDEF\uDDF0\uDDF2\uDDF4\uDDFF])|\uD83C\uDDE8(?:\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDEE\uDDF0-\uDDF5\uDDF7\uDDFA-\uDDFF])|\uD83C\uDDE7(?:\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEF\uDDF1-\uDDF4\uDDF6-\uDDF9\uDDFB\uDDFC\uDDFE\uDDFF])|\uD83C\uDDE6(?:\uD83C[\uDDE8-\uDDEC\uDDEE\uDDF1\uDDF2\uDDF4\uDDF6-\uDDFA\uDDFC\uDDFD\uDDFF])|[#\*0-9]\u20E3|(?:\uD83C[\uDF85\uDFC3\uDFC7]|\uD83D[\uDC43\uDC4A-\uDC4C\uDC4F\uDC50\uDC66-\uDC69\uDC6B-\uDC6E\uDC70-\uDC78\uDC7C\uDC81-\uDC83\uDC85-\uDC87\uDC8F\uDC91\uDCAA\uDD7A\uDD95\uDD96\uDE45-\uDE47\uDE4B-\uDE4F\uDEA3\uDEB4-\uDEB6\uDEC0\uDECC]|\uD83E[\uDD0C\uDD0F\uDD18-\uDD1F\uDD26\uDD30-\uDD39\uDD3D\uDD3E\uDD77\uDDB5\uDDB6\uDDB8\uDDB9\uDDBB\uDDCD-\uDDCF\uDDD1-\uDDDD\uDEC3-\uDEC5\uDEF0-\uDEF8])(?:\uD83C[\uDFFB-\uDFFF])|(?:[\u261D\u26F9\u270A-\u270D]|\uD83C[\uDFC2\uDFC4\uDFCA-\uDFCC]|\uD83D[\uDC42\uDC46-\uDC49\uDC4D\uDC4E\uDD74\uDD75\uDD90])(?:[\uFE0E\uFE0F]|\uD83C[\uDFFB-\uDFFF])|(?:[\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u2648-\u2653\u265F\u2660\u2663\u2665\u2666\u2668\u267B\u267E\u267F\u2692-\u2697\u2699\u269B\u269C\u26A0\u26A1\u26A7\u26AA\u26AB\u26B0\u26B1\u26BD\u26BE\u26C4\u26C5\u26C8\u26CE\u26CF\u26D1\u26D3\u26D4\u26E9\u26EA\u26F0-\u26F5\u26F7\u26F8\u26FA\u26FD\u2702\u2705\u2708\u2709\u270F\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763\u2764\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299]|\uD83C[\uDC04\uDD70\uDD71\uDD7E\uDD7F\uDE02\uDE1A\uDE2F\uDE37\uDF0D-\uDF0F\uDF15\uDF1C\uDF21\uDF24-\uDF2C\uDF36\uDF78\uDF7D\uDF93\uDF96\uDF97\uDF99-\uDF9B\uDF9E\uDF9F\uDFA7\uDFAC-\uDFAE\uDFC6\uDFCD\uDFCE\uDFD4-\uDFE0\uDFED\uDFF3\uDFF5\uDFF7]|\uD83D[\uDC08\uDC15\uDC1F\uDC26\uDC3F\uDC41\uDC53\uDC6A\uDC7D\uDCA3\uDCB0\uDCB3\uDCBB\uDCBF\uDCCB\uDCDA\uDCDF\uDCE4-\uDCE6\uDCEA-\uDCED\uDCF7\uDCF9-\uDCFB\uDCFD\uDD08\uDD0D\uDD12\uDD13\uDD49\uDD4A\uDD50-\uDD67\uDD6F\uDD70\uDD73\uDD76-\uDD79\uDD87\uDD8A-\uDD8D\uDDA5\uDDA8\uDDB1\uDDB2\uDDBC\uDDC2-\uDDC4\uDDD1-\uDDD3\uDDDC-\uDDDE\uDDE1\uDDE3\uDDE8\uDDEF\uDDF3\uDDFA\uDE10\uDE87\uDE8D\uDE91\uDE94\uDE98\uDEAD\uDEB2\uDEB9\uDEBA\uDEBC\uDECB\uDECD-\uDECF\uDEE0-\uDEE5\uDEE9\uDEF0\uDEF3])[\uFE0E\uFE0F]|[\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u261D\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u2648-\u2653\u265F\u2660\u2663\u2665\u2666\u2668\u267B\u267E\u267F\u2692-\u2697\u2699\u269B\u269C\u26A0\u26A1\u26A7\u26AA\u26AB\u26B0\u26B1\u26BD\u26BE\u26C4\u26C5\u26C8\u26CE\u26CF\u26D1\u26D3\u26D4\u26E9\u26EA\u26F0-\u26F5\u26F7-\u26FA\u26FD\u2702\u2705\u2708-\u270D\u270F\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763\u2764\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299]|\uD83C[\uDC04\uDCCF\uDD70\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDD9A\uDDE6-\uDDFF\uDE01\uDE02\uDE1A\uDE2F\uDE32-\uDE3A\uDE50\uDE51\uDF00-\uDF21\uDF24-\uDF93\uDF96\uDF97\uDF99-\uDF9B\uDF9E-\uDFF0\uDFF3-\uDFF5\uDFF7-\uDFFF]|\uD83D[\uDC00-\uDCFD\uDCFF-\uDD3D\uDD49-\uDD4E\uDD50-\uDD67\uDD6F\uDD70\uDD73-\uDD7A\uDD87\uDD8A-\uDD8D\uDD90\uDD95\uDD96\uDDA4\uDDA5\uDDA8\uDDB1\uDDB2\uDDBC\uDDC2-\uDDC4\uDDD1-\uDDD3\uDDDC-\uDDDE\uDDE1\uDDE3\uDDE8\uDDEF\uDDF3\uDDFA-\uDE4F\uDE80-\uDEC5\uDECB-\uDED2\uDED5-\uDED7\uDEDC-\uDEE5\uDEE9\uDEEB\uDEEC\uDEF0\uDEF3-\uDEFC\uDFE0-\uDFEB\uDFF0]|\uD83E[\uDD0C-\uDD3A\uDD3C-\uDD45\uDD47-\uDDFF\uDE70-\uDE7C\uDE80-\uDE88\uDE90-\uDEBD\uDEBF-\uDEC5\uDECE-\uDEDB\uDEE0-\uDEE8\uDEF0-\uDEF8]/;const Ve=ce(Qe);/*!
 * element-emotes
 * Copyright (C) 2022-present  Michael Serajnik  https://github.com/mserajnik
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */let T,K;const Xe=u=>{for(const e of g.get("emotes"))u=u.split(`:${e.name}:`).join("");return u},Ge=u=>(u=Xe(u.replace(/\s/g,"").replace(/[\u200D\u2003]/g,"").replace(new RegExp(Ve.source,"gi"),"")),u.trim()===""),Ye=u=>u.match(/^.+\/emotes\/.+\.(gif|apng)(\?.+)?$/)?u.split("/emotes/").join("/frozen-emotes/"):null,fe=(u=!1)=>{const e=document.querySelectorAll("[data-frozen-emote-url]");if(e.length)for(const t of e){if(u){t.src=t.dataset.frozenEmoteUrl;continue}t.src=t.dataset.emoteUrl}},me=(u,e=!1)=>{if(u.dataset.emotesReplaced&&!e)return;const t=u.querySelector(".mx_EventTile_body");if(!t)return;let n=t.innerHTML;const D=Ge(t.textContent)?`max-height:${g.get("largeEmoteSize")};vertical-align:bottom`:`max-height:${g.get("defaultEmoteSize")}`;for(const r of g.get("emotes")){const s=Ye(r.url);n=n.split(`:${r.name}:`).join(`<img
          style="${D}"`+(K&&s?document.hasFocus()?`src="${r.url}?accessKey=${T}"`:`src="${s}?accessKey=${T}"`:`src="${r.url}?accessKey=${T}"`)+`data-emote-url="${r.url}?accessKey=${T}"`+(K&&s?`data-frozen-emote-url="${s}?accessKey=${T}"`:"")+`alt="${r.name}"
          title="${r.name}">`)}t.innerHTML=n,u.dataset.emotesReplaced=!0},Me=u=>{if(u.classList&&u.classList.contains("mx_EventTile_content")){me(u);return}if(u.classList&&u.classList.contains("mx_EventTile_edited")){me(u.parentNode,!0);return}u.childNodes&&[...u.childNodes].forEach(Me)},Je={initialize:()=>{T=g.get("accessKey"),K=g.get("useFrozenEmotes"),new MutationObserver(u=>{for(const e of u)for(const t of e.addedNodes)Me(t)}).observe(document.body,{childList:!0,subtree:!0}),K&&(window.focus(),window.addEventListener("focus",()=>{fe(!1)}),window.addEventListener("blur",()=>{fe(!0)}))}};var Q={},$={},xe={exports:{}};(function(u){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function D(o,c,a){this.fn=o,this.context=c,this.once=a||!1}function r(o,c,a,l,F){if(typeof a!="function")throw new TypeError("The listener must be a function");var d=new D(a,l||o,F),E=t?t+c:c;return o._events[E]?o._events[E].fn?o._events[E]=[o._events[E],d]:o._events[E].push(d):(o._events[E]=d,o._eventsCount++),o}function s(o,c){--o._eventsCount===0?o._events=new n:delete o._events[c]}function i(){this._events=new n,this._eventsCount=0}i.prototype.eventNames=function(){var c=[],a,l;if(this._eventsCount===0)return c;for(l in a=this._events)e.call(a,l)&&c.push(t?l.slice(1):l);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(a)):c},i.prototype.listeners=function(c){var a=t?t+c:c,l=this._events[a];if(!l)return[];if(l.fn)return[l.fn];for(var F=0,d=l.length,E=new Array(d);F<d;F++)E[F]=l[F].fn;return E},i.prototype.listenerCount=function(c){var a=t?t+c:c,l=this._events[a];return l?l.fn?1:l.length:0},i.prototype.emit=function(c,a,l,F,d,E){var m=t?t+c:c;if(!this._events[m])return!1;var C=this._events[m],p=arguments.length,B,f;if(C.fn){switch(C.once&&this.removeListener(c,C.fn,void 0,!0),p){case 1:return C.fn.call(C.context),!0;case 2:return C.fn.call(C.context,a),!0;case 3:return C.fn.call(C.context,a,l),!0;case 4:return C.fn.call(C.context,a,l,F),!0;case 5:return C.fn.call(C.context,a,l,F,d),!0;case 6:return C.fn.call(C.context,a,l,F,d,E),!0}for(f=1,B=new Array(p-1);f<p;f++)B[f-1]=arguments[f];C.fn.apply(C.context,B)}else{var I=C.length,L;for(f=0;f<I;f++)switch(C[f].once&&this.removeListener(c,C[f].fn,void 0,!0),p){case 1:C[f].fn.call(C[f].context);break;case 2:C[f].fn.call(C[f].context,a);break;case 3:C[f].fn.call(C[f].context,a,l);break;case 4:C[f].fn.call(C[f].context,a,l,F);break;default:if(!B)for(L=1,B=new Array(p-1);L<p;L++)B[L-1]=arguments[L];C[f].fn.apply(C[f].context,B)}}return!0},i.prototype.on=function(c,a,l){return r(this,c,a,l,!1)},i.prototype.once=function(c,a,l){return r(this,c,a,l,!0)},i.prototype.removeListener=function(c,a,l,F){var d=t?t+c:c;if(!this._events[d])return this;if(!a)return s(this,d),this;var E=this._events[d];if(E.fn)E.fn===a&&(!F||E.once)&&(!l||E.context===l)&&s(this,d);else{for(var m=0,C=[],p=E.length;m<p;m++)(E[m].fn!==a||F&&!E[m].once||l&&E[m].context!==l)&&C.push(E[m]);C.length?this._events[d]=C.length===1?C[0]:C:s(this,d)}return this},i.prototype.removeAllListeners=function(c){var a;return c?(a=t?t+c:c,this._events[a]&&s(this,a)):(this._events=new n,this._eventsCount=0),this},i.prototype.off=i.prototype.removeListener,i.prototype.addListener=i.prototype.on,i.prefixed=t,i.EventEmitter=i,u.exports=i})(xe);var V=xe.exports,ae={},j={};Object.defineProperty(j,"__esModule",{value:!0});j.SearchResult=void 0;const Ze=/\$&/g,qe=/\$(\d)/g;class eu{constructor(e,t,n){this.data=e,this.term=t,this.strategy=n}getReplacementData(e){let t=this.strategy.replace(this.data);if(t==null)return null;let n="";Array.isArray(t)&&(n=t[1],t=t[0]);const D=this.strategy.match(e);if(D==null||D.index==null)return null;const r=t.replace(Ze,D[0]).replace(qe,(s,i)=>D[parseInt(i)]);return{start:D.index,end:D.index+D[0].length,beforeCursor:r,afterCursor:n}}replace(e,t){const n=this.getReplacementData(e);if(n!==null)return t=n.afterCursor+t,[[e.slice(0,n.start),n.beforeCursor,e.slice(n.end)].join(""),t]}render(){return this.strategy.renderTemplate(this.data,this.term)}getStrategyId(){return this.strategy.getId()}}j.SearchResult=eu;(function(u){Object.defineProperty(u,"__esModule",{value:!0}),u.Strategy=u.DEFAULT_INDEX=void 0;const e=j;u.DEFAULT_INDEX=1;class t{constructor(D){this.props=D,this.cache={}}destroy(){return this.cache={},this}replace(D){return this.props.replace(D)}execute(D,r){var s;const i=this.matchWithContext(D);if(!i)return!1;const o=i[(s=this.props.index)!==null&&s!==void 0?s:u.DEFAULT_INDEX];return this.search(o,c=>{r(c.map(a=>new e.SearchResult(a,o,this)))},i),!0}renderTemplate(D,r){if(this.props.template)return this.props.template(D,r);if(typeof D=="string")return D;throw new Error(`Unexpected render data type: ${typeof D}. Please implement template parameter by yourself`)}getId(){return this.props.id||null}match(D){return typeof this.props.match=="function"?this.props.match(D):D.match(this.props.match)}search(D,r,s){this.props.cache?this.searchWithCach(D,r,s):this.props.search(D,r,s)}matchWithContext(D){const r=this.context(D);return r===!1?null:this.match(r===!0?D:r)}context(D){return this.props.context?this.props.context(D):!0}searchWithCach(D,r,s){this.cache[D]!=null?r(this.cache[D]):this.props.search(D,i=>{this.cache[D]=i,r(i)},s)}}u.Strategy=t})(ae);Object.defineProperty($,"__esModule",{value:!0});$.Completer=void 0;const uu=V,tu=ae;class Du extends uu.EventEmitter{constructor(e){super(),this.handleQueryResult=t=>{this.emit("hit",{searchResults:t})},this.strategies=e.map(t=>new tu.Strategy(t))}destroy(){return this.strategies.forEach(e=>e.destroy()),this}run(e){for(const t of this.strategies)if(t.execute(e,this.handleQueryResult))return;this.handleQueryResult([])}}$.Completer=Du;var le={},R={};Object.defineProperty(R,"__esModule",{value:!0});R.createCustomEvent=void 0;const nu=typeof window<"u"&&!!window.CustomEvent,su=(u,e)=>{if(nu)return new CustomEvent(u,e);const t=document.createEvent("CustomEvent");return t.initCustomEvent(u,!1,(e==null?void 0:e.cancelable)||!1,(e==null?void 0:e.detail)||void 0),t};R.createCustomEvent=su;(function(u){Object.defineProperty(u,"__esModule",{value:!0}),u.Dropdown=u.DEFAULT_DROPDOWN_ITEM_ACTIVE_CLASS_NAME=u.DEFAULT_DROPDOWN_ITEM_CLASS_NAME=u.DEFAULT_DROPDOWN_CLASS_NAME=u.DEFAULT_DROPDOWN_PLACEMENT=u.DEFAULT_DROPDOWN_MAX_COUNT=void 0;const e=V,t=R;u.DEFAULT_DROPDOWN_MAX_COUNT=10,u.DEFAULT_DROPDOWN_PLACEMENT="auto",u.DEFAULT_DROPDOWN_CLASS_NAME="dropdown-menu textcomplete-dropdown",u.DEFAULT_DROPDOWN_ITEM_CLASS_NAME="textcomplete-item",u.DEFAULT_DROPDOWN_ITEM_ACTIVE_CLASS_NAME=`${u.DEFAULT_DROPDOWN_ITEM_CLASS_NAME} active`;class n extends e.EventEmitter{static create(s){const i=document.createElement("ul");i.className=s.className||u.DEFAULT_DROPDOWN_CLASS_NAME,Object.assign(i.style,{display:"none",position:"absolute",zIndex:"1000"},s.style);const o=s.parent||document.body;return o==null||o.appendChild(i),new n(i,s)}constructor(s,i){super(),this.el=s,this.option=i,this.shown=!1,this.items=[],this.activeIndex=null}render(s,i){const o=(0,t.createCustomEvent)("render",{cancelable:!0});return this.emit("render",o),o.defaultPrevented?this:(this.clear(),s.length===0?this.hide():(this.items=s.slice(0,this.option.maxCount||u.DEFAULT_DROPDOWN_MAX_COUNT).map((c,a)=>{var l;return new D(this,a,c,((l=this.option)===null||l===void 0?void 0:l.item)||{})}),this.setStrategyId(s[0]).renderEdge(s,"header").renderItems().renderEdge(s,"footer").show().setOffset(i).activate(0),this.emit("rendered",(0,t.createCustomEvent)("rendered")),this))}destroy(){var s;return this.clear(),(s=this.el.parentNode)===null||s===void 0||s.removeChild(this.el),this}select(s){const i={searchResult:s.searchResult},o=(0,t.createCustomEvent)("select",{cancelable:!0,detail:i});return this.emit("select",o),o.defaultPrevented?this:(this.hide(),this.emit("selected",(0,t.createCustomEvent)("selected",{detail:i})),this)}show(){if(!this.shown){const s=(0,t.createCustomEvent)("show",{cancelable:!0});if(this.emit("show",s),s.defaultPrevented)return this;this.el.style.display="block",this.shown=!0,this.emit("shown",(0,t.createCustomEvent)("shown"))}return this}hide(){if(this.shown){const s=(0,t.createCustomEvent)("hide",{cancelable:!0});if(this.emit("hide",s),s.defaultPrevented)return this;this.el.style.display="none",this.shown=!1,this.clear(),this.emit("hidden",(0,t.createCustomEvent)("hidden"))}return this}clear(){return this.items.forEach(s=>s.destroy()),this.items=[],this.el.innerHTML="",this.activeIndex=null,this}up(s){return this.shown?this.moveActiveItem("prev",s):this}down(s){return this.shown?this.moveActiveItem("next",s):this}moveActiveItem(s,i){if(this.activeIndex!=null){const o=s==="next"?this.getNextActiveIndex():this.getPrevActiveIndex();o!=null&&(this.activate(o),i.preventDefault())}return this}activate(s){return this.activeIndex!==s&&(this.activeIndex!=null&&this.items[this.activeIndex].deactivate(),this.activeIndex=s,this.items[s].activate()),this}isShown(){return this.shown}getActiveItem(){return this.activeIndex!=null?this.items[this.activeIndex]:null}setOffset(s){const i=document.documentElement;if(i){const o=this.el.offsetWidth;if(s.left){const l=this.option.dynamicWidth?i.scrollWidth:i.clientWidth;s.left+o>l&&(s.left=l-o),this.el.style.left=`${s.left}px`}else s.right&&(s.right-o<0&&(s.right=0),this.el.style.right=`${s.right}px`);let c=!1;const a=this.option.placement||u.DEFAULT_DROPDOWN_PLACEMENT;if(a==="auto"){const l=this.items.length*s.lineHeight;c=s.clientTop!=null&&s.clientTop+l>i.clientHeight}a==="top"||c?(this.el.style.bottom=`${i.clientHeight-s.top+s.lineHeight}px`,this.el.style.top="auto"):(this.el.style.top=`${s.top}px`,this.el.style.bottom="auto")}return this}getNextActiveIndex(){if(this.activeIndex==null)throw new Error;return this.activeIndex<this.items.length-1?this.activeIndex+1:this.option.rotate?0:null}getPrevActiveIndex(){if(this.activeIndex==null)throw new Error;return this.activeIndex!==0?this.activeIndex-1:this.option.rotate?this.items.length-1:null}renderItems(){const s=document.createDocumentFragment();for(const i of this.items)s.appendChild(i.el);return this.el.appendChild(s),this}setStrategyId(s){const i=s.getStrategyId();return i&&(this.el.dataset.strategy=i),this}renderEdge(s,i){const o=this.option[i],c=document.createElement("li");return c.className=`textcomplete-${i}`,c.innerHTML=typeof o=="function"?o(s.map(a=>a.data)):o||"",this.el.appendChild(c),this}}u.Dropdown=n;class D{constructor(s,i,o,c){this.dropdown=s,this.index=i,this.searchResult=o,this.props=c,this.active=!1,this.onClick=F=>{F.preventDefault(),this.dropdown.select(this)},this.className=this.props.className||u.DEFAULT_DROPDOWN_ITEM_CLASS_NAME,this.activeClassName=this.props.activeClassName||u.DEFAULT_DROPDOWN_ITEM_ACTIVE_CLASS_NAME;const a=document.createElement("li");a.className=this.active?this.activeClassName:this.className;const l=document.createElement("span");l.tabIndex=-1,l.innerHTML=this.searchResult.render(),a.appendChild(l),a.addEventListener("click",this.onClick),this.el=a}destroy(){var s;const i=this.el;return(s=i.parentNode)===null||s===void 0||s.removeChild(i),i.removeEventListener("click",this.onClick,!1),this}activate(){return this.active||(this.active=!0,this.el.className=this.activeClassName,this.dropdown.el.scrollTop=this.el.offsetTop),this}deactivate(){return this.active&&(this.active=!1,this.el.className=this.className),this}}})(le);var X={};Object.defineProperty(X,"__esModule",{value:!0});X.Editor=void 0;const ru=V,H=R;class iu extends ru.EventEmitter{destroy(){return this}applySearchResult(e){throw new Error("Not implemented.")}getCursorOffset(){throw new Error("Not implemented.")}getBeforeCursor(){throw new Error("Not implemented.")}emitMoveEvent(e){const t=(0,H.createCustomEvent)("move",{cancelable:!0,detail:{code:e}});return this.emit("move",t),t}emitEnterEvent(){const e=(0,H.createCustomEvent)("enter",{cancelable:!0});return this.emit("enter",e),e}emitChangeEvent(){const e=(0,H.createCustomEvent)("change",{detail:{beforeCursor:this.getBeforeCursor()}});return this.emit("change",e),e}emitEscEvent(){const e=(0,H.createCustomEvent)("esc",{cancelable:!0});return this.emit("esc",e),e}getCode(e){switch(e.keyCode){case 9:case 13:return"ENTER";case 27:return"ESC";case 38:return"UP";case 40:return"DOWN";case 78:if(e.ctrlKey)return"DOWN";break;case 80:if(e.ctrlKey)return"UP";break}return"OTHER"}}X.Editor=iu;var G={};Object.defineProperty(G,"__esModule",{value:!0});G.Textcomplete=void 0;const ou=V,cu=le,au=$,lu=["show","shown","render","rendered","selected","hidden","hide"];let Fu=class extends ou.EventEmitter{constructor(e,t,n){super(),this.editor=e,this.isQueryInFlight=!1,this.nextPendingQuery=null,this.handleHit=({searchResults:D})=>{D.length?this.dropdown.render(D,this.editor.getCursorOffset()):this.dropdown.hide(),this.isQueryInFlight=!1,this.nextPendingQuery!==null&&this.trigger(this.nextPendingQuery)},this.handleMove=D=>{D.detail.code==="UP"?this.dropdown.up(D):this.dropdown.down(D)},this.handleEnter=D=>{const r=this.dropdown.getActiveItem();r?(this.dropdown.select(r),D.preventDefault()):this.dropdown.hide()},this.handleEsc=D=>{this.dropdown.isShown()&&(this.dropdown.hide(),D.preventDefault())},this.handleChange=D=>{D.detail.beforeCursor!=null?this.trigger(D.detail.beforeCursor):this.dropdown.hide()},this.handleSelect=D=>{this.emit("select",D),D.defaultPrevented||this.editor.applySearchResult(D.detail.searchResult)},this.handleResize=()=>{this.dropdown.isShown()&&this.dropdown.setOffset(this.editor.getCursorOffset())},this.completer=new au.Completer(t),this.dropdown=cu.Dropdown.create((n==null?void 0:n.dropdown)||{}),this.startListening()}destroy(e=!0){return this.completer.destroy(),this.dropdown.destroy(),e&&this.editor.destroy(),this.stopListening(),this}isShown(){return this.dropdown.isShown()}hide(){return this.dropdown.hide(),this}trigger(e){return this.isQueryInFlight?this.nextPendingQuery=e:(this.isQueryInFlight=!0,this.nextPendingQuery=null,this.completer.run(e)),this}startListening(){var e;this.editor.on("move",this.handleMove).on("enter",this.handleEnter).on("esc",this.handleEsc).on("change",this.handleChange),this.dropdown.on("select",this.handleSelect);for(const t of lu)this.dropdown.on(t,n=>this.emit(t,n));this.completer.on("hit",this.handleHit),(e=this.dropdown.el.ownerDocument.defaultView)===null||e===void 0||e.addEventListener("resize",this.handleResize)}stopListening(){var e;(e=this.dropdown.el.ownerDocument.defaultView)===null||e===void 0||e.removeEventListener("resize",this.handleResize),this.completer.removeAllListeners(),this.dropdown.removeAllListeners(),this.editor.removeListener("move",this.handleMove).removeListener("enter",this.handleEnter).removeListener("esc",this.handleEsc).removeListener("change",this.handleChange)}};G.Textcomplete=Fu;(function(u){var e=_&&_.__createBinding||(Object.create?function(n,D,r,s){s===void 0&&(s=r);var i=Object.getOwnPropertyDescriptor(D,r);(!i||("get"in i?!D.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return D[r]}}),Object.defineProperty(n,s,i)}:function(n,D,r,s){s===void 0&&(s=r),n[s]=D[r]}),t=_&&_.__exportStar||function(n,D){for(var r in n)r!=="default"&&!Object.prototype.hasOwnProperty.call(D,r)&&e(D,n,r)};Object.defineProperty(u,"__esModule",{value:!0}),t($,u),t(le,u),t(X,u),t(j,u),t(ae,u),t(G,u),t(R,u)})(Q);const be=ce(Q),hu=we({__proto__:null,default:be},[Q]);var Fe={},Y={},Se={},J={};Object.defineProperty(J,"__esModule",{value:!0});J.calculateElementOffset=void 0;const Cu=u=>{const e=u.getBoundingClientRect(),t=u.ownerDocument;if(t==null)throw new Error("Given element does not belong to document");const{defaultView:n,documentElement:D}=t;if(n==null)throw new Error("Given element does not belong to window");const r={top:e.top+n.pageYOffset,left:e.left+n.pageXOffset};return D&&(r.top-=D.clientTop,r.left-=D.clientLeft),r};J.calculateElementOffset=Cu;var Z={};Object.defineProperty(Z,"__esModule",{value:!0});Z.getLineHeightPx=void 0;const Eu=48,du=57,pe=u=>Eu<=u&&u<=du,fu=u=>{const e=getComputedStyle(u),t=e.lineHeight;if(pe(t.charCodeAt(0))){const n=parseFloat(t);return pe(t.charCodeAt(t.length-1))?n*parseFloat(e.fontSize):n}return mu(u.nodeName,e)};Z.getLineHeightPx=fu;const mu=(u,e)=>{const t=document.body;if(!t)return 0;const n=document.createElement(u);n.innerHTML="&nbsp;",Object.assign(n.style,{fontSize:e.fontSize,fontFamily:e.fontFamily,padding:"0"}),t.appendChild(n),n instanceof HTMLTextAreaElement&&(n.rows=1);const D=n.offsetHeight;return t.removeChild(n),D};var q={};Object.defineProperty(q,"__esModule",{value:!0});q.isSafari=void 0;const pu=()=>/^((?!chrome|android).)*safari/i.test(navigator.userAgent);q.isSafari=pu;(function(u){var e=_&&_.__createBinding||(Object.create?function(n,D,r,s){s===void 0&&(s=r);var i=Object.getOwnPropertyDescriptor(D,r);(!i||("get"in i?!D.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return D[r]}}),Object.defineProperty(n,s,i)}:function(n,D,r,s){s===void 0&&(s=r),n[s]=D[r]}),t=_&&_.__exportStar||function(n,D){for(var r in n)r!=="default"&&!Object.prototype.hasOwnProperty.call(D,r)&&e(D,n,r)};Object.defineProperty(u,"__esModule",{value:!0}),t(J,u),t(Z,u),t(q,u)})(Se);Object.defineProperty(Y,"__esModule",{value:!0});Y.ContenteditableEditor=void 0;const gu=Q,ge=Se;let Bu=class extends gu.Editor{constructor(e){super(),this.el=e,this.onInput=()=>{this.el.normalize(),this.emitChangeEvent()},this.onKeydown=t=>{const n=this.getCode(t);let D;n==="UP"||n==="DOWN"?D=this.emitMoveEvent(n):n==="ENTER"?D=this.emitEnterEvent():n==="ESC"&&(D=this.emitEscEvent()),D&&D.defaultPrevented&&t.preventDefault()},this.startListening=()=>{this.el.addEventListener("input",this.onInput),this.el.addEventListener("keydown",this.onKeydown)},this.stopListening=()=>{this.el.removeEventListener("input",this.onInput),this.el.removeEventListener("keydown",this.onKeydown)},this.startListening()}destroy(){return super.destroy(),this.stopListening(),this}applySearchResult(e){const t=this.getBeforeCursor(),n=this.getAfterCursor();if(t!=null&&n!=null){const D=e.replace(t,n);if(Array.isArray(D)){let r=D[0];(0,ge.isSafari)()&&(r=r.replace(t,""));const s=this.getRange();if(s.selectNode(s.startContainer),this.el.dataset.requiresManualDeletions){for(let o=0;o<t.length;o++)this.el.ownerDocument.execCommand("delete",!1,null);for(let o=0;o<n.length;o++)this.el.ownerDocument.execCommand("forwardDelete",!1,null)}this.el.ownerDocument.execCommand("insertText",!1,r+D[1]),s.detach();const i=this.getRange();i.setStart(i.startContainer,r.length),i.collapse(!0)}}}getCursorOffset(){const e=this.getRange(),t=e.getBoundingClientRect(),n=this.el.ownerDocument.body.getBoundingClientRect(),D=e.startContainer,r=D instanceof Text?D.parentElement:D,s=t.left,i=(0,ge.getLineHeightPx)(r),o=t.top-n.top+i;return this.el.dir!=="rtl"?{left:s,lineHeight:i,top:o}:{right:document.documentElement.clientWidth-s,lineHeight:i,top:o}}getBeforeCursor(){const e=this.getRange();return e.collapsed&&e.startContainer instanceof Text?e.startContainer.wholeText.substring(0,e.startOffset):null}getAfterCursor(){const e=this.getRange();return e.collapsed&&e.startContainer instanceof Text?e.startContainer.wholeText.substring(e.startOffset):null}getRange(e){var t;const n=(t=this.el.ownerDocument.defaultView)===null||t===void 0?void 0:t.getSelection();if(n==null)throw new Error("The element does not belong to view");for(let s=0,i=n.rangeCount;s<i;s++){const o=n.getRangeAt(s);if(this.el.contains(o.startContainer))return o}if(e)throw new Error("Unexpected");const D=this.el.ownerDocument.activeElement;this.el.focus();const r=this.getRange(!0);if(D){const s=D;s.focus&&s.focus()}return r}};Y.ContenteditableEditor=Bu;(function(u){var e=_&&_.__createBinding||(Object.create?function(n,D,r,s){s===void 0&&(s=r);var i=Object.getOwnPropertyDescriptor(D,r);(!i||("get"in i?!D.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return D[r]}}),Object.defineProperty(n,s,i)}:function(n,D,r,s){s===void 0&&(s=r),n[s]=D[r]}),t=_&&_.__exportStar||function(n,D){for(var r in n)r!=="default"&&!Object.prototype.hasOwnProperty.call(D,r)&&e(D,n,r)};Object.defineProperty(u,"__esModule",{value:!0}),t(Y,u)})(Fe);const Le=ce(Fe),vu=we({__proto__:null,default:Le},[Fe]);function M(u){return Array.isArray?Array.isArray(u):Ne(u)==="[object Array]"}const Au=1/0;function _u(u){if(typeof u=="string")return u;let e=u+"";return e=="0"&&1/u==-Au?"-0":e}function yu(u){return u==null?"":_u(u)}function w(u){return typeof u=="string"}function Oe(u){return typeof u=="number"}function wu(u){return u===!0||u===!1||Mu(u)&&Ne(u)=="[object Boolean]"}function Ie(u){return typeof u=="object"}function Mu(u){return Ie(u)&&u!==null}function v(u){return u!=null}function te(u){return!u.trim().length}function Ne(u){return u==null?u===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(u)}const xu="Incorrect 'index' type",bu=u=>`Invalid value for key ${u}`,Su=u=>`Pattern length exceeds max of ${u}.`,Lu=u=>`Missing ${u} property in key`,Ou=u=>`Property 'weight' in key '${u}' must be a positive integer`,Be=Object.prototype.hasOwnProperty;class Iu{constructor(e){this._keys=[],this._keyMap={};let t=0;e.forEach(n=>{let D=Te(n);this._keys.push(D),this._keyMap[D.id]=D,t+=D.weight}),this._keys.forEach(n=>{n.weight/=t})}get(e){return this._keyMap[e]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function Te(u){let e=null,t=null,n=null,D=1,r=null;if(w(u)||M(u))n=u,e=ve(u),t=De(u);else{if(!Be.call(u,"name"))throw new Error(Lu("name"));const s=u.name;if(n=s,Be.call(u,"weight")&&(D=u.weight,D<=0))throw new Error(Ou(s));e=ve(s),t=De(s),r=u.getFn}return{path:e,id:t,weight:D,src:n,getFn:r}}function ve(u){return M(u)?u:u.split(".")}function De(u){return M(u)?u.join("."):u}function Nu(u,e){let t=[],n=!1;const D=(r,s,i)=>{if(v(r))if(!s[i])t.push(r);else{let o=s[i];const c=r[o];if(!v(c))return;if(i===s.length-1&&(w(c)||Oe(c)||wu(c)))t.push(yu(c));else if(M(c)){n=!0;for(let a=0,l=c.length;a<l;a+=1)D(c[a],s,i+1)}else s.length&&D(c,s,i+1)}};return D(u,w(e)?e.split("."):e,0),n?t:t[0]}const Tu={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},Ru={isCaseSensitive:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(u,e)=>u.score===e.score?u.idx<e.idx?-1:1:u.score<e.score?-1:1},Pu={location:0,threshold:.6,distance:100},$u={useExtendedSearch:!1,getFn:Nu,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1};var h={...Ru,...Tu,...Pu,...$u};const ju=/[^ ]+/g;function zu(u=1,e=3){const t=new Map,n=Math.pow(10,e);return{get(D){const r=D.match(ju).length;if(t.has(r))return t.get(r);const s=1/Math.pow(r,.5*u),i=parseFloat(Math.round(s*n)/n);return t.set(r,i),i},clear(){t.clear()}}}class he{constructor({getFn:e=h.getFn,fieldNormWeight:t=h.fieldNormWeight}={}){this.norm=zu(t,3),this.getFn=e,this.isCreated=!1,this.setIndexRecords()}setSources(e=[]){this.docs=e}setIndexRecords(e=[]){this.records=e}setKeys(e=[]){this.keys=e,this._keysMap={},e.forEach((t,n)=>{this._keysMap[t.id]=n})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,w(this.docs[0])?this.docs.forEach((e,t)=>{this._addString(e,t)}):this.docs.forEach((e,t)=>{this._addObject(e,t)}),this.norm.clear())}add(e){const t=this.size();w(e)?this._addString(e,t):this._addObject(e,t)}removeAt(e){this.records.splice(e,1);for(let t=e,n=this.size();t<n;t+=1)this.records[t].i-=1}getValueForItemAtKeyId(e,t){return e[this._keysMap[t]]}size(){return this.records.length}_addString(e,t){if(!v(e)||te(e))return;let n={v:e,i:t,n:this.norm.get(e)};this.records.push(n)}_addObject(e,t){let n={i:t,$:{}};this.keys.forEach((D,r)=>{let s=D.getFn?D.getFn(e):this.getFn(e,D.path);if(v(s)){if(M(s)){let i=[];const o=[{nestedArrIndex:-1,value:s}];for(;o.length;){const{nestedArrIndex:c,value:a}=o.pop();if(v(a))if(w(a)&&!te(a)){let l={v:a,i:c,n:this.norm.get(a)};i.push(l)}else M(a)&&a.forEach((l,F)=>{o.push({nestedArrIndex:F,value:l})})}n.$[r]=i}else if(w(s)&&!te(s)){let i={v:s,n:this.norm.get(s)};n.$[r]=i}}}),this.records.push(n)}toJSON(){return{keys:this.keys,records:this.records}}}function Re(u,e,{getFn:t=h.getFn,fieldNormWeight:n=h.fieldNormWeight}={}){const D=new he({getFn:t,fieldNormWeight:n});return D.setKeys(u.map(Te)),D.setSources(e),D.create(),D}function Wu(u,{getFn:e=h.getFn,fieldNormWeight:t=h.fieldNormWeight}={}){const{keys:n,records:D}=u,r=new he({getFn:e,fieldNormWeight:t});return r.setKeys(n),r.setIndexRecords(D),r}function U(u,{errors:e=0,currentLocation:t=0,expectedLocation:n=0,distance:D=h.distance,ignoreLocation:r=h.ignoreLocation}={}){const s=e/u.length;if(r)return s;const i=Math.abs(n-t);return D?s+i/D:i?1:s}function Hu(u=[],e=h.minMatchCharLength){let t=[],n=-1,D=-1,r=0;for(let s=u.length;r<s;r+=1){let i=u[r];i&&n===-1?n=r:!i&&n!==-1&&(D=r-1,D-n+1>=e&&t.push([n,D]),n=-1)}return u[r-1]&&r-n>=e&&t.push([n,r-1]),t}const O=32;function Uu(u,e,t,{location:n=h.location,distance:D=h.distance,threshold:r=h.threshold,findAllMatches:s=h.findAllMatches,minMatchCharLength:i=h.minMatchCharLength,includeMatches:o=h.includeMatches,ignoreLocation:c=h.ignoreLocation}={}){if(e.length>O)throw new Error(Su(O));const a=e.length,l=u.length,F=Math.max(0,Math.min(n,l));let d=r,E=F;const m=i>1||o,C=m?Array(l):[];let p;for(;(p=u.indexOf(e,E))>-1;){let A=U(e,{currentLocation:p,expectedLocation:F,distance:D,ignoreLocation:c});if(d=Math.min(A,d),E=p+a,m){let x=0;for(;x<a;)C[p+x]=1,x+=1}}E=-1;let B=[],f=1,I=a+l;const L=1<<a-1;for(let A=0;A<a;A+=1){let x=0,b=I;for(;x<b;)U(e,{errors:A,currentLocation:F+b,expectedLocation:F,distance:D,ignoreLocation:c})<=d?x=b:I=b,b=Math.floor((I-x)/2+x);I=b;let Ce=Math.max(1,F-b+1),ue=s?l:Math.min(F+b,l)+a,N=Array(ue+2);N[ue+1]=(1<<A)-1;for(let y=ue;y>=Ce;y-=1){let z=y-1,Ee=t[u.charAt(z)];if(m&&(C[z]=+!!Ee),N[y]=(N[y+1]<<1|1)&Ee,A&&(N[y]|=(B[y+1]|B[y])<<1|1|B[y+1]),N[y]&L&&(f=U(e,{errors:A,currentLocation:z,expectedLocation:F,distance:D,ignoreLocation:c}),f<=d)){if(d=f,E=z,E<=F)break;Ce=Math.max(1,2*F-E)}}if(U(e,{errors:A+1,currentLocation:F,expectedLocation:F,distance:D,ignoreLocation:c})>d)break;B=N}const ee={isMatch:E>=0,score:Math.max(.001,f)};if(m){const A=Hu(C,i);A.length?o&&(ee.indices=A):ee.isMatch=!1}return ee}function Ku(u){let e={};for(let t=0,n=u.length;t<n;t+=1){const D=u.charAt(t);e[D]=(e[D]||0)|1<<n-t-1}return e}class Pe{constructor(e,{location:t=h.location,threshold:n=h.threshold,distance:D=h.distance,includeMatches:r=h.includeMatches,findAllMatches:s=h.findAllMatches,minMatchCharLength:i=h.minMatchCharLength,isCaseSensitive:o=h.isCaseSensitive,ignoreLocation:c=h.ignoreLocation}={}){if(this.options={location:t,threshold:n,distance:D,includeMatches:r,findAllMatches:s,minMatchCharLength:i,isCaseSensitive:o,ignoreLocation:c},this.pattern=o?e:e.toLowerCase(),this.chunks=[],!this.pattern.length)return;const a=(F,d)=>{this.chunks.push({pattern:F,alphabet:Ku(F),startIndex:d})},l=this.pattern.length;if(l>O){let F=0;const d=l%O,E=l-d;for(;F<E;)a(this.pattern.substr(F,O),F),F+=O;if(d){const m=l-O;a(this.pattern.substr(m),m)}}else a(this.pattern,0)}searchIn(e){const{isCaseSensitive:t,includeMatches:n}=this.options;if(t||(e=e.toLowerCase()),this.pattern===e){let E={isMatch:!0,score:0};return n&&(E.indices=[[0,e.length-1]]),E}const{location:D,distance:r,threshold:s,findAllMatches:i,minMatchCharLength:o,ignoreLocation:c}=this.options;let a=[],l=0,F=!1;this.chunks.forEach(({pattern:E,alphabet:m,startIndex:C})=>{const{isMatch:p,score:B,indices:f}=Uu(e,E,m,{location:D+C,distance:r,threshold:s,findAllMatches:i,minMatchCharLength:o,includeMatches:n,ignoreLocation:c});p&&(F=!0),l+=B,p&&f&&(a=[...a,...f])});let d={isMatch:F,score:F?l/this.chunks.length:1};return F&&n&&(d.indices=a),d}}class S{constructor(e){this.pattern=e}static isMultiMatch(e){return Ae(e,this.multiRegex)}static isSingleMatch(e){return Ae(e,this.singleRegex)}search(){}}function Ae(u,e){const t=u.match(e);return t?t[1]:null}class ku extends S{constructor(e){super(e)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(e){const t=e===this.pattern;return{isMatch:t,score:t?0:1,indices:[0,this.pattern.length-1]}}}class Qu extends S{constructor(e){super(e)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(e){const n=e.indexOf(this.pattern)===-1;return{isMatch:n,score:n?0:1,indices:[0,e.length-1]}}}class Vu extends S{constructor(e){super(e)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(e){const t=e.startsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,this.pattern.length-1]}}}class Xu extends S{constructor(e){super(e)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(e){const t=!e.startsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}}class Gu extends S{constructor(e){super(e)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(e){const t=e.endsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[e.length-this.pattern.length,e.length-1]}}}class Yu extends S{constructor(e){super(e)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(e){const t=!e.endsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}}class $e extends S{constructor(e,{location:t=h.location,threshold:n=h.threshold,distance:D=h.distance,includeMatches:r=h.includeMatches,findAllMatches:s=h.findAllMatches,minMatchCharLength:i=h.minMatchCharLength,isCaseSensitive:o=h.isCaseSensitive,ignoreLocation:c=h.ignoreLocation}={}){super(e),this._bitapSearch=new Pe(e,{location:t,threshold:n,distance:D,includeMatches:r,findAllMatches:s,minMatchCharLength:i,isCaseSensitive:o,ignoreLocation:c})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(e){return this._bitapSearch.searchIn(e)}}class je extends S{constructor(e){super(e)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(e){let t=0,n;const D=[],r=this.pattern.length;for(;(n=e.indexOf(this.pattern,t))>-1;)t=n+r,D.push([n,t-1]);const s=!!D.length;return{isMatch:s,score:s?0:1,indices:D}}}const ne=[ku,je,Vu,Xu,Yu,Gu,Qu,$e],_e=ne.length,Ju=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,Zu="|";function qu(u,e={}){return u.split(Zu).map(t=>{let n=t.trim().split(Ju).filter(r=>r&&!!r.trim()),D=[];for(let r=0,s=n.length;r<s;r+=1){const i=n[r];let o=!1,c=-1;for(;!o&&++c<_e;){const a=ne[c];let l=a.isMultiMatch(i);l&&(D.push(new a(l,e)),o=!0)}if(!o)for(c=-1;++c<_e;){const a=ne[c];let l=a.isSingleMatch(i);if(l){D.push(new a(l,e));break}}}return D})}const et=new Set([$e.type,je.type]);class ut{constructor(e,{isCaseSensitive:t=h.isCaseSensitive,includeMatches:n=h.includeMatches,minMatchCharLength:D=h.minMatchCharLength,ignoreLocation:r=h.ignoreLocation,findAllMatches:s=h.findAllMatches,location:i=h.location,threshold:o=h.threshold,distance:c=h.distance}={}){this.query=null,this.options={isCaseSensitive:t,includeMatches:n,minMatchCharLength:D,findAllMatches:s,ignoreLocation:r,location:i,threshold:o,distance:c},this.pattern=t?e:e.toLowerCase(),this.query=qu(this.pattern,this.options)}static condition(e,t){return t.useExtendedSearch}searchIn(e){const t=this.query;if(!t)return{isMatch:!1,score:1};const{includeMatches:n,isCaseSensitive:D}=this.options;e=D?e:e.toLowerCase();let r=0,s=[],i=0;for(let o=0,c=t.length;o<c;o+=1){const a=t[o];s.length=0,r=0;for(let l=0,F=a.length;l<F;l+=1){const d=a[l],{isMatch:E,indices:m,score:C}=d.search(e);if(E){if(r+=1,i+=C,n){const p=d.constructor.type;et.has(p)?s=[...s,...m]:s.push(m)}}else{i=0,r=0,s.length=0;break}}if(r){let l={isMatch:!0,score:i/r};return n&&(l.indices=s),l}}return{isMatch:!1,score:1}}}const se=[];function tt(...u){se.push(...u)}function re(u,e){for(let t=0,n=se.length;t<n;t+=1){let D=se[t];if(D.condition(u,e))return new D(u,e)}return new Pe(u,e)}const k={AND:"$and",OR:"$or"},ie={PATH:"$path",PATTERN:"$val"},oe=u=>!!(u[k.AND]||u[k.OR]),Dt=u=>!!u[ie.PATH],nt=u=>!M(u)&&Ie(u)&&!oe(u),ye=u=>({[k.AND]:Object.keys(u).map(e=>({[e]:u[e]}))});function ze(u,e,{auto:t=!0}={}){const n=D=>{let r=Object.keys(D);const s=Dt(D);if(!s&&r.length>1&&!oe(D))return n(ye(D));if(nt(D)){const o=s?D[ie.PATH]:r[0],c=s?D[ie.PATTERN]:D[o];if(!w(c))throw new Error(bu(o));const a={keyId:De(o),pattern:c};return t&&(a.searcher=re(c,e)),a}let i={children:[],operator:r[0]};return r.forEach(o=>{const c=D[o];M(c)&&c.forEach(a=>{i.children.push(n(a))})}),i};return oe(u)||(u=ye(u)),n(u)}function st(u,{ignoreFieldNorm:e=h.ignoreFieldNorm}){u.forEach(t=>{let n=1;t.matches.forEach(({key:D,norm:r,score:s})=>{const i=D?D.weight:null;n*=Math.pow(s===0&&i?Number.EPSILON:s,(i||1)*(e?1:r))}),t.score=n})}function rt(u,e){const t=u.matches;e.matches=[],v(t)&&t.forEach(n=>{if(!v(n.indices)||!n.indices.length)return;const{indices:D,value:r}=n;let s={indices:D,value:r};n.key&&(s.key=n.key.src),n.idx>-1&&(s.refIndex=n.idx),e.matches.push(s)})}function it(u,e){e.score=u.score}function ot(u,e,{includeMatches:t=h.includeMatches,includeScore:n=h.includeScore}={}){const D=[];return t&&D.push(rt),n&&D.push(it),u.map(r=>{const{idx:s}=r,i={item:e[s],refIndex:s};return D.length&&D.forEach(o=>{o(r,i)}),i})}class P{constructor(e,t={},n){this.options={...h,...t},this.options.useExtendedSearch,this._keyStore=new Iu(this.options.keys),this.setCollection(e,n)}setCollection(e,t){if(this._docs=e,t&&!(t instanceof he))throw new Error(xu);this._myIndex=t||Re(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(e){v(e)&&(this._docs.push(e),this._myIndex.add(e))}remove(e=()=>!1){const t=[];for(let n=0,D=this._docs.length;n<D;n+=1){const r=this._docs[n];e(r,n)&&(this.removeAt(n),n-=1,D-=1,t.push(r))}return t}removeAt(e){this._docs.splice(e,1),this._myIndex.removeAt(e)}getIndex(){return this._myIndex}search(e,{limit:t=-1}={}){const{includeMatches:n,includeScore:D,shouldSort:r,sortFn:s,ignoreFieldNorm:i}=this.options;let o=w(e)?w(this._docs[0])?this._searchStringList(e):this._searchObjectList(e):this._searchLogical(e);return st(o,{ignoreFieldNorm:i}),r&&o.sort(s),Oe(t)&&t>-1&&(o=o.slice(0,t)),ot(o,this._docs,{includeMatches:n,includeScore:D})}_searchStringList(e){const t=re(e,this.options),{records:n}=this._myIndex,D=[];return n.forEach(({v:r,i:s,n:i})=>{if(!v(r))return;const{isMatch:o,score:c,indices:a}=t.searchIn(r);o&&D.push({item:r,idx:s,matches:[{score:c,value:r,norm:i,indices:a}]})}),D}_searchLogical(e){const t=ze(e,this.options),n=(i,o,c)=>{if(!i.children){const{keyId:l,searcher:F}=i,d=this._findMatches({key:this._keyStore.get(l),value:this._myIndex.getValueForItemAtKeyId(o,l),searcher:F});return d&&d.length?[{idx:c,item:o,matches:d}]:[]}const a=[];for(let l=0,F=i.children.length;l<F;l+=1){const d=i.children[l],E=n(d,o,c);if(E.length)a.push(...E);else if(i.operator===k.AND)return[]}return a},D=this._myIndex.records,r={},s=[];return D.forEach(({$:i,i:o})=>{if(v(i)){let c=n(t,i,o);c.length&&(r[o]||(r[o]={idx:o,item:i,matches:[]},s.push(r[o])),c.forEach(({matches:a})=>{r[o].matches.push(...a)}))}}),s}_searchObjectList(e){const t=re(e,this.options),{keys:n,records:D}=this._myIndex,r=[];return D.forEach(({$:s,i})=>{if(!v(s))return;let o=[];n.forEach((c,a)=>{o.push(...this._findMatches({key:c,value:s[a],searcher:t}))}),o.length&&r.push({idx:i,item:s,matches:o})}),r}_findMatches({key:e,value:t,searcher:n}){if(!v(t))return[];let D=[];if(M(t))t.forEach(({v:r,i:s,n:i})=>{if(!v(r))return;const{isMatch:o,score:c,indices:a}=n.searchIn(r);o&&D.push({score:c,key:e,value:r,idx:s,norm:i,indices:a})});else{const{v:r,n:s}=t,{isMatch:i,score:o,indices:c}=n.searchIn(r);i&&D.push({score:o,key:e,value:r,norm:s,indices:c})}return D}}P.version="7.0.0";P.createIndex=Re;P.parseIndex=Wu;P.config=h;P.parseQuery=ze;tt(ut);const{Textcomplete:ct}=be||hu,{ContenteditableEditor:at}=Le||vu;let We,He;const lt=u=>{let e=u.split(":").join("");if(g.get("useEmoteFuzzyMatching"))return We.search(e);e=e.toLowerCase();const t=g.get("emotes"),n=[];for(const D of t)D.name.toLowerCase().includes(e)&&n.push({item:D});return n},Ft={id:"emote",match:/\B:([-+\w]*)$/,index:1,search:async(u,e,t)=>{e(lt(u))},cache:!1,template:u=>`<img src="${u.item.url}?accessKey=${g.get("accessKey")}">&nbsp;<small>${u.item.name}</small>`,replace:u=>`:${u.item.name}: `},ht=async(u,e=!1)=>{if(u.dataset.handlingEmoteSuggestions)return;u.dataset.handlingEmoteSuggestions=!0,e&&(u.dataset.requiresManualDeletions=!0);const t=new ct(new at(u),[Ft],He);new MutationObserver((n,D)=>{document.body.contains(u)||(t.destroy(),D.disconnect())}).observe(document.body,{childList:!0,subtree:!0})},Ue=u=>{if(u.nodeType!==Node.ELEMENT_NODE)return;const e=[{class:"mx_BasicMessageComposer_input",requiresManualDeletions:!1},{class:"mx_WysiwygComposer_Editor_content",requiresManualDeletions:!0}];if(u.classList){for(const t of e)if(u.classList.contains(t.class)){ht(u,t.requiresManualDeletions);return}}u.childNodes&&[...u.childNodes].forEach(Ue)},Ct={initialize:()=>{g.get("useEmoteFuzzyMatching")&&(We=new P(g.get("emotes"),{keys:["name"],location:g.get("emoteFuzzyMatchingLocation"),distance:g.get("emoteFuzzyMatchingDistance"),threshold:g.get("emoteFuzzyMatchingThreshold")})),He={dropdown:{className:"dropdown-menu textcomplete-dropdown mx_Autocomplete",maxCount:g.get("emoteSuggestionAmount"),placement:"top",header:()=>"",footer:()=>"",rotate:!0,style:{display:"none",position:"absolute",zIndex:"1000"},parent:document.body,item:{className:"textcomplete-item mx_Autocomplete_Completion_pill",activeClassName:"textcomplete-item active mx_Autocomplete_Completion_pill mx_Autocomplete_Completion selected"}}},new MutationObserver(u=>{for(const e of u)for(const t of e.addedNodes)Ue(t)}).observe(document.body,{childList:!0,subtree:!0})}};/*!
 * element-emotes
 * Copyright (C) 2022-present  Michael Serajnik  https://github.com/mserajnik
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */(async()=>{try{await g.initialize()}catch(u){alert(u);return}Je.initialize(),Ct.initialize()})();
